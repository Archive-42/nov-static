<!DOCTYPE html><html><head>
      <title>w11-d4_data-driven-app</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\almyk\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.13\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header undefined" id="week-11-day-4brdata-driven-app">WEEK-11 DAY-4<br><em>Data-Driven App</em></h1>

<hr>
<div class="code-chunk" data-id="code-chunk-id-0" data-cmd="toc"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><ul>
<li><a href="#data-driven-web-sites-learning-objectives">Data-Driven Web Sites Learning Objectives</a></li>
<li><a href="#acclimating-to-environment-variables">Acclimating to Environment Variables</a>
<ul>
<li><a href="#what-are-environment-variables">What are environment variables?</a></li>
<li><a href="#setting-and-getting-environment-variable-values">Setting and getting environment variable values</a></li>
<li><a href="#storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</a></li>
<li><a href="#using-a-module-to-organize-environment-variables">Using a module to organize environment variables</a></li>
<li><a href="#what-you-learned">What you learned</a></li>
</ul>
</li>
<li><a href="#asynchronous-route-handlers-in-express">Asynchronous Route Handlers in Express</a>
<ul>
<li><a href="#calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</a></li>
<li><a href="#reducing-boilerplate-code">Reducing boilerplate code</a></li>
<li><a href="#what-you-learned-1">What you learned</a></li>
<li><a href="#see-also">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#handling-errors-in-express">Handling Errors in Express</a>
<ul>
<li><a href="#setting-up-an-example-express-application">Setting up an example Express application</a></li>
<li><a href="#the-default-error-handler-in-express">The default error handler in Express</a></li>
<li><a href="#defining-a-custom-error-handler">Defining a custom error handler</a></li>
<li><a href="#handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</a></li>
<li><a href="#what-you-learned-2">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-part-1-setting-up-the-project">Data-Driven Websites - Part 1: Setting Up the Project</a>
<ul>
<li><a href="#setting-up-the-project">Setting up the project</a></li>
<li><a href="#stubbing-out-the-application">Stubbing out the application</a></li>
<li><a href="#splitting-the-application-and-server-into-separate-modules">Splitting the application and server into separate modules</a></li>
<li><a href="#logging-requests-using-morgan">Logging requests using Morgan</a></li>
<li><a href="#adding-custom-error-handlers">Adding custom error handlers</a></li>
<li><a href="#configuring-environment-variables">Configuring environment variables</a></li>
<li><a href="#setting-up-bootstrap">Setting up Bootstrap</a></li>
<li><a href="#what-you-learned-3">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-2-integrating-sequelize-with-express">Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</a>
<ul>
<li><a href="#installing-and-configuring-sequelize">Installing and configuring Sequelize</a></li>
<li><a href="#testing-the-connection-to-the-database">Testing the connection to the database</a></li>
<li><a href="#creating-the-book-model">Creating the Book model</a></li>
<li><a href="#seeding-the-database">Seeding the database</a></li>
<li><a href="#querying-and-rendering-a-temporary-list-of-books">Querying and rendering a temporary list of books</a></li>
<li><a href="#what-you-learned-4">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations">Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</a>
<ul>
<li><a href="#planning-the-routes-and-views">Planning the routes and views</a></li>
<li><a href="#creating-the-book-list-page">Creating the Book List page</a></li>
<li><a href="#adding-the-add-book-page">Adding the Add Book page</a></li>
<li><a href="#implementing-server-side-validation-using-sequelize">Implementing server-side validation using Sequelize</a></li>
<li><a href="#implementing-server-side-validation-using-a-validation-library">Implementing server-side validation using a validation library</a></li>
<li><a href="#adding-the-edit-book-page">Adding the Edit Book page</a></li>
<li><a href="#add-the-delete-book-page">Add the Delete Book page</a></li>
<li><a href="#what-you-learned-5">What you learned</a></li>
</ul>
</li>
</ul>
<hr>
<hr>
<h1 class="mume-header" id="data-driven-web-sites-learning-objectives">Data-Driven Web Sites Learning Objectives</h1>

<p>This is where it all comes together: databases, HTTP servers, HTML, CSS, request<br>
and response, JavaScript powering it all. This is <strong>full-stack</strong>. At the end of<br>
this content, you should be able to:</p>
<ol>
<li>Use environment variables to specify configuration of or provide sensitive<br>
information for your code</li>
<li>Use the <code>dotenv</code> npm package to load environment variables defined in an<br>
<code>.env</code> file</li>
<li>Recall that Express cannot process unhandled Promise rejections from<br>
within route handler (or middleware) functions;</li>
<li>Use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with <code>async</code>/<code>await</code><br>
to properly handle errors thrown from within an asynchronous route handler<br>
(or middleware) function</li>
<li>Write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions</li>
<li>Use the <code>morgan</code> npm package to log requests to the terminal window to assist<br>
with auditing and debugging</li>
<li>Add support for the Bootstrap front-end component library to a Pug layout<br>
template</li>
<li>Install and configure Sequelize within an Express application.</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup</li>
<li>Define a collection of routes (and views) that perform CRUD operations<br>
against a single resource using Sequelize</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues</li>
<li>Describe how an Express.js error handler function differs from middleware<br>
and route handler functions</li>
<li>Define a global Express.js error-handling function to catch and process<br>
unhandled errors</li>
<li>Define a middleware function to handle requests for unknown routes by<br>
returning a 404 NOT FOUND error</li>
</ol>
<hr>
<h1 class="mume-header" id="acclimating-to-environment-variables">Acclimating to Environment Variables</h1>

<p>As your Express applications increase in complexity, the need to have a<br>
convenient way to configure your applications will also increase.</p>
<p>For example, consider an application that uses a database for data persistence.<br>
To connect to the database, do you simply provide the username and password to<br>
use when making a connection to the database directly in your code? What if your<br>
teammate uses a different username or password? Do they modify the code to make<br>
it work for them? If they do that, how do you keep the application working on<br>
your system?</p>
<p>It&apos;s not just the differences between you and your teammates&apos; systems. Your<br>
applications won&apos;t always run locally; eventually they&apos;ll need to run on<br>
external servers to facilitate testing or to ultimately serve your end users. In<br>
most cases, your application will need to be configured differently when it&apos;s<br>
running on an external server than when it&apos;s running locally.</p>
<p>You need a solution for managing your application&apos;s configuration! When you<br>
finish this article, you should be able to:</p>
<ul>
<li>Recall what environment variables are and how they&apos;re commonly used;</li>
<li>Set and get an environment variable value;</li>
<li>Store environment variable values in an <code>.env</code> file;</li>
<li>Use a module to organize environment variables; and</li>
<li>Understand how to run npm scripts in different environments.</li>
</ul>
<h2 class="mume-header" id="what-are-environment-variables">What are environment variables?</h2>

<p>To understand what an environment variable is, we need to start with<br>
understanding what an environment is.</p>
<p>An environment is the system that an application is deployed to and running in.<br>
Up to now your applications have been running on your local machine, which is<br>
typically referred to as the &quot;local environment&quot; or &quot;local development<br>
environment&quot;.</p>
<p>For real life applications, there are usually several environments&#x2014;aside from<br>
each developer&apos;s local environment&#x2014;that the application will be deployed and ran<br>
within:</p>
<ul>
<li>Testing - An environment that&apos;s used to test the application to ensure that<br>
recent changes don&apos;t affect existing functionality and that new features meet<br>
the project&apos;s requirements.</li>
<li>Staging - An environment that mirrors the production environment to ensure<br>
that nothing unexpected occurs before the application is deployed to<br>
production.</li>
<li>Production - The environment that serves end users. For applications that need<br>
to support a large number of users, the production environment can contain<br>
multiple servers (sometimes dozens or even hundreds of servers).</li>
</ul>
<p>Environment variables are application configuration related variables whose<br>
values change depending on the environment that the application is running in.<br>
Using environment variables allows you to change the behavior of your<br>
application by the environment that it&apos;s running in without having to hard code<br>
values in your code.</p>
<h3 class="mume-header" id="how-are-environment-variables-commonly-used">How are environment variables commonly used?</h3>

<p>In an earlier lesson, you learned how to use the Sequelize ORM to connect to a<br>
PostgreSQL database to retrieve, create, update, and delete data. To connect to<br>
the database, you provided values for the following configuration variables<br>
within a module named <code>config/database.js</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;mydbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;mydbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;mydbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The database connection settings that you use in your local development<br>
environment&#x2014;in particular the <code>username</code> and <code>password</code> values&#x2014;won&apos;t be the same<br>
that the testing, staging, or production environments will need.</p>
<p>Sequelize allows you to define database connection settings per environment like<br>
this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;mydbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;mydbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;mydbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  test<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;testdbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;testdbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;testdbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  production<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;proddbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;proddbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;proddbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>While you could hard code different settings for each environment this approach<br>
is inelegant, difficult to maintain, and insecure. Application configuration can<br>
unexpectedly need to change in test, staging, and production environments.<br>
Having to make a code change to change an application&apos;s configuration in a<br>
specific environment isn&apos;t ideal.</p>
<p>Using environment variables for the database connection settings separates the<br>
configuration from the application&apos;s code and allows the configuration to be<br>
updated without having to make a code change.</p>
<p>Where else should you use environment variables? Anywhere that the behavior of<br>
your code needs to change based upon the environment that it&apos;s running in.<br>
Environment variables are commonly used for:</p>
<ul>
<li>Database connection settings (as you&apos;ve just seen)</li>
<li>Server HTTP ports</li>
<li>Static file locations</li>
<li>API keys and secrets</li>
</ul>
<h2 class="mume-header" id="setting-and-getting-environment-variable-values">Setting and getting environment variable values</h2>

<p>Now that you know what environment variables are and how they&apos;re used, it&apos;s time<br>
to see how to set and get an environment variable value.</p>
<h3 class="mume-header" id="setting-an-environment-variable-value">Setting an environment variable value</h3>

<p>The simplest way to set an environment variable, is via the command line, by<br>
declaring and setting the environment variable before the <code>node</code> command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">PORT<span class="token operator">=</span>8080 node app.js
</pre><p>You can even declare and set multiple environment variables:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">PORT<span class="token operator">=</span>8080 NODE_ENV<span class="token operator">=</span>development node app.js
</pre><blockquote>
<p>The <code>NODE_ENV</code> environment variable is a special variable that&apos;s used by<br>
many node programs to determine what environment the application is running<br>
in. For example, setting the <code>NODE_ENV</code> environment variable to <code>production</code><br>
enables features in Express that help to improve the overall performance of<br>
your application. For more information, see <a href="https://expressjs.com/en/advanced/best-practice-performance.html#set-node_env-to-production">this page</a> in<br>
the Express documentation.<br>
Sequelize also uses the <code>NODE_ENV</code> variable to determine which section of the<br>
<code>config.json</code> file it will use for database configuration.</p>
</blockquote>
<p>This approach also works within an npm <code>start</code> script:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PORT=8080 NODE_ENV=development node app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="getting-an-environment-variable-value">Getting an environment variable value</h3>

<p>To get an environment variable value, you simply use the <code>process.env</code> property:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">;</span>
</pre><p>The <code>process</code> object is a global Node object, so you can safely access the<br>
<code>process.env</code> property from anywhere within your Node application.</p>
<p>If the <code>PORT</code> environment variable isn&apos;t declared and set, it&apos;ll have a value of<br>
<code>undefined</code>. You can use the logical <code>OR</code> (<code>||</code>) operator to provide a default<br>
value in code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</h2>

<p>Passing environment variables from the command line is not an ideal solution.<br>
Defining an npm <code>start</code> script keeps you from having to type the variables again<br>
and again, but it&apos;s still not a convenient way to maintain them.</p>
<p>Using the <code>dotenv</code> npm package, you can declare and set all of your environment<br>
variables in a <code>.env</code> file and the <code>dotenv</code> package will load your variables<br>
from that file and set them on the <code>process.env</code> property.</p>
<p>To start, install the <code>dotenv</code> npm package as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dotenv --save-dev
</pre><blockquote>
<p>Remember that npm tracks two main types of dependencies in the <code>package.json</code><br>
file: dependencies (<code>dependencies</code>) and development dependencies<br>
(<code>devDependencies</code>). <em>Dependencies</em> (<code>dependencies</code>) are the packages that<br>
your project needs in order to successfully run when in production (i.e. your<br>
application has been deployed or published to a server that can be accessed by<br>
your users). <em>Development dependencies</em> (<code>devDependencies</code>) are the packages<br>
that are needed locally when doing development work on the project. Passing<br>
the <code>--save-dev</code> flag when installing a dependency tells npm to install the<br>
dependency as a development dependency.</p>
</blockquote>
<p>Then add an <code>.env</code> file to the root of your project that contains all of your<br>
environment variables:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=mydbuser
DB_PASSWORD=mydbuserpassword
DB_DATABASE=mydbname
DB_HOST=localhost
</code></pre><blockquote>
<p><strong>Pro tip for VS Code users:</strong> Install the <a href="https://marketplace.visualstudio.com/items?itemName=mikestead.dotenv">DotENV extension</a> to add syntax coloring in <code>.env</code> files.</p>
</blockquote>
<h3 class="mume-header" id="loading-environment-variables-on-application-startup">Loading environment variables on application startup</h3>

<p>Using the <code>dotenv</code> npm package, it&apos;s easy to load your environment variables<br>
when your Express application starts up. Just run this code before you configure<br>
and start your Express application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Load the environment variables from the .env file</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;dotenv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="another-way-to-use-dotenv">Another way to use dotenv</h3>

<p>Another way to use the dotenv module is to load it before your app loads on<br>
the Node.JS command line by using Node.JS&apos;s <code>-r</code> option to require a module<br>
immediately.  To use it this way you could change your <code>npm start</code> command<br>
in your package.json to look like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">  <span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node -r dotenv/config app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Doing it this way makes sure that all of the environment variables are loaded<br>
before you execute any of the code of your app.</p>
<p>Whichever way you decide to go, the main point is to load the contents of your<br>
<code>.env</code> file as early as possible so those variables will be available to your<br>
code.</p>
<h3 class="mume-header" id="keeping-the-env-file-out-of-source-control">Keeping the <code>.env</code> file out of source control</h3>

<p>It&apos;s important to keep your <code>.env</code> file out of your source control as it will<br>
often contain sensitive information like database connection settings or API<br>
keys and secrets. If you&apos;re using Git for your source control, make sure that<br>
your <code>.gitignore</code> file includes an entry for <code>.env</code> files.</p>
<p>If you&apos;re working on a team, you&apos;ll need a way to document what the contents of<br>
the <code>.env</code> should look like. One approach is to update the project&apos;s <code>README.md</code><br>
file with instructions on what environment variables need to be defined in the<br>
<code>.env</code> file. Another option is to add an <code>.env.example</code> file to your project<br>
that mirrors the contents of the <code>.env</code> file but replaces any sensitive<br>
information with dummy values:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=dbuser
DB_PASSWORD=dbuserpassword
DB_DATABASE=dbname
DB_HOST=localhost
</code></pre><p>In many companies, managing the environment variables or <code>.env</code> files will<br>
be handled by whatever process the company uses to get the code deployed and<br>
running on the actual servers. Often companies will have dedicated teams of<br>
System Administrators or &quot;DevOps&quot; personnel that handle these tasks. As a<br>
developer you may have to work with these teams to determine what the best<br>
strategy is for getting the environment variables set for your application.</p>
<h2 class="mume-header" id="using-a-module-to-organize-environment-variables">Using a module to organize environment variables</h2>

<p>Earlier we mentioned that the <code>process</code> object is a global Node object, which<br>
means that you can safely access the <code>process.env</code> property from anywhere within<br>
your Node application. While that&apos;s true, you might find it helpful to<br>
encapsulate all of your <code>process.env</code> property access into a single <code>config</code><br>
module. The <code>config</code> module has a single purpose: to import all of your<br>
environment variables and export them to make them available to the rest of your<br>
application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_USERNAME</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_DATABASE</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_HOST</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Creating a <code>config</code> module also gives you a convenient place to optionally<br>
provide default values and to alias environment variable names (notice how the<br>
<code>NODE_ENV</code> environment variable is being aliased to <code>environment</code>).</p>
<p>Any other module in your application that needs access to a configuration<br>
variable value just needs to require the <code>config</code> module:</p>
<blockquote>
<p>Make sure this is done after the environment variables are loaded if you are<br>
using the <code>dotenv</code> module.</p>
</blockquote>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Load the environment variables from the .env file</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;dotenv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the port environment variable value.</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start listening for connections.</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how destructuring is being used to get a specific configuration variable<br>
value when requiring the <code>config</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Without using destructuring, you could get the <code>port</code> configuration variable<br>
value like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> config<span class="token punctuation">.</span>port<span class="token punctuation">;</span>
</pre><p>Or like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token punctuation">;</span>
</pre><p>Any of these approaches work fine. Deciding which to use is one of the many<br>
stylistic choices you&apos;ll make as a developer.</p>
<h3 class="mume-header" id="running-npm-binaries">Running npm binaries</h3>

<p>Using npx to run an npm binary like the Sequelize CLI won&apos;t work if you&apos;ve<br>
defined environment variables in an <code>.env</code> file for your database connection<br>
settings. You&apos;ll need to use a tool like the <code>dotenv-cli</code> npm package as an<br>
intermediary between npx and the Sequelize CLI to load your environment<br>
variables from the <code>.env</code> file and run the command that you pass into it.</p>
<p>To start, install the <code>dotenv-cli</code> package as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dotenv-cli --save-dev
</pre><p>Then use npx to run the <code>dotenv</code> command passing in the command to invoke using<br>
the set of environment variables loaded from your <code>.env</code> file:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:migrate
</pre><h3 class="mume-header" id="defining-environment-specific-npm-scripts">Defining environment specific npm scripts</h3>

<p>Sometimes you may want to run different npm scripts for different <code>NODE_ENV</code><br>
environments.</p>
<p>For instance you might have this in your package.json for local development.</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>But in production we may not want to run nodemon, since our code won&apos;t be<br>
changing constantly. Perhaps, production needs a package.json like this instead:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>To keep from having to manually change your npm <code>start</code> script before you deploy<br>
your application to the production environment, you can use a tool like the<br>
<code>per-env</code> npm package that allows you to define npm scripts for each of your<br>
application&apos;s environments.</p>
<p>To start, install the <code>per-env</code> package:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> per-env
</pre><p>Then update your npm scripts to this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;per-env&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>If the <code>NODE_ENV</code> environment variable is set to <code>production</code>, then running the<br>
<code>start</code> script will result in the execution of the <code>start:production</code> script. If<br>
the <code>NODE_ENV</code> variable isn&apos;t defined, then the <code>start:development</code> script will<br>
be executed by default.</p>
<p>Using this approach, you can conveniently define a <code>start</code> script (or any<br>
predefined or custom script) for each environment that your application will be<br>
deployed to.</p>
<h2 class="mume-header" id="what-you-learned">What you learned</h2>

<p>In this article, you learned how to</p>
<ul>
<li>set and get an environment variable value</li>
<li>store environment variable values in an <code>.env</code> file</li>
<li>use a module to organize environment variables</li>
<li>handle running different npm scripts in different environments.</li>
</ul>
<hr>
<h1 class="mume-header" id="asynchronous-route-handlers-in-express">Asynchronous Route Handlers in Express</h1>

<p>Up to this point, your Express route handler functions have been<br>
synchronous&#x2014;each statement predictably executes in the order that they&apos;re<br>
written in. Most Express applications, at some point, need to interact with a<br>
database or an API (or both). Interacting with those external resources requires<br>
you to write asynchronous code, which in turn requires your route handler<br>
functions to be asynchronous.</p>
<p>In modern JavaScript applications, writing asynchronous code means working with<br>
Promises and optionally the <code>async</code>/<code>await</code> keywords. When working with Promises<br>
in Express route handlers or middleware functions, special attention needs to be<br>
spent on how errors are handled.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Recall that Express cannot process unhandled Promise rejections from<br>
within route handler (or middleware) functions;</li>
<li>Use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with <code>async</code>/<code>await</code><br>
to properly handle errors thrown from within an asynchronous route handler (or<br>
middleware) function; and</li>
<li>Write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions.</li>
</ul>
<h2 class="mume-header" id="calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</h2>

<p>To see how to properly call asynchronous functions or methods within route<br>
handlers, you need an asynchronous function or method to call.</p>
<h3 class="mume-header" id="creating-a-simple-asynchronous-function">Creating a simple asynchronous function</h3>

<p>In a future article, you&apos;ll see how to integrate your Express application with a<br>
database. For now keep things as simple as possible by creating a standalone<br>
function that wraps the built-in <code>setTimeout()</code> function in a Promise:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
* Asynchronous function that delays for the provided length of time.
* If the length of time to wait is less than &apos;0&apos;, then the returned
* Promise will reject, otherwise it&apos;ll resolve.
* @param {number} timeToWait - The length of time to wait in milliseconds.
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timeToWait</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>timeToWait <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error has occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`All done waiting for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeToWait<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms!`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>timeToWait<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The above <code>delay()</code> function accepts a <code>timeToWait</code> value and returns a new<br>
Promise that calls the <code>setTimeout()</code> function passing in the <code>timeToWait</code><br>
absolute value. When the <code>setTimeout()</code> function call completes, the Promise is<br>
resolved if the <code>timeToWait</code> value is a positive number or it&apos;s rejected if the<br>
<code>timeToWait</code> value is a negative number.</p>
<blockquote>
<p><strong>Note:</strong> The <code>Math.abs()</code> function is used to get the absolute value of the<br>
<code>timeToWait</code> parameter value. Getting the absolute value ensures that the<br>
value passed to the <code>setTimeout()</code> function is always a positive number. For<br>
more information about absolute values, see <a href="https://en.wikipedia.org/wiki/Absolute_value">this Wikipedia page</a>.</p>
</blockquote>
<h3 class="mume-header" id="setting-up-the-express-application">Setting up the Express application</h3>

<p>With your <code>delay()</code> function in hand, use it to create a simple Express<br>
application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Asynchronous function that delays for the provided length of time.
* If the length of time to wait is less than &apos;0&apos;, then the returned
* Promise will reject, otherwise it&apos;ll resolve.
* @param {number} timeToWait - The length of time to wait in milliseconds.
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timeToWait</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>timeToWait <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error has occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`All done waiting for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeToWait<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms!`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>timeToWait<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Note:</strong> If you&apos;re following along, don&apos;t forget to use npm to install<br>
Express (i.e. <code>npm install express</code>)!</p>
</blockquote>
<p>Now call the <code>delay()</code> function within your route handler function. Remember<br>
that the <code>delay()</code> function returns a Promise, so you can use the Promise<br>
<code>then()</code> method to execute code when the <code>delay()</code> method completes. Within the<br>
callback that you pass to the <code>then()</code> method, send the value returned from the<br>
<code>delay()</code> function to the client using the <code>res.send()</code> method:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>If you start your application (i.e. <code>node app.js</code>) and browse to<br>
<code>http://localhost:8080/</code> you&apos;ll see that the request hangs for 5 seconds before<br>
the server sends the response &quot;All done waiting for 5000ms!&quot;</p>
<p>Feel free to experiment by varying the number of milliseconds that you&apos;re<br>
passing to the <code>delay()</code> function. For now, continue to pass a positive number;<br>
we&apos;ll see in just a moment what happens when we pass a negative number.</p>
<h3 class="mume-header" id="using-asyncawait">Using <code>async</code>/<code>await</code></h3>

<p>Instead of using the Promise <code>then()</code> method to execute code when an<br>
asynchronous function or method call has completed, you can use the <code>await</code><br>
keyword.</p>
<p>Start with adding the <code>async</code> keyword to your route handler function to indicate<br>
that it&apos;s going to make an asynchronous function or method call. Then use the<br>
<code>await</code> keyword to wait for a result to be returned from the <code>delay()</code> function<br>
call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>If you test your application again you&apos;ll see that it behaves the same as it did<br>
before&#x2014;the request hangs for 5 seconds before the server sends the response &quot;All<br>
done waiting for 5000ms!&quot;</p>
<h3 class="mume-header" id="catching-errors-thrown-by-asynchronous-functions-or-methods">Catching errors thrown by asynchronous functions or methods</h3>

<p>So far, you&apos;ve stayed on the &quot;happy&quot; path by passing a positive number to the<br>
<code>delay()</code> function. If you pass a negative number to the <code>delay()</code> function,<br>
it&apos;ll throw an error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This time when testing your application, the browser will indefinitely hang as<br>
it waits for the server to return a response. If you look in the terminal,<br>
you&apos;ll see that an error occurred:</p>
<pre data-role="codeBlock" data-info class="language-"><code>(node:89455) UnhandledPromiseRejectionWarning: Error: An error has occurred!
    at Timeout._onTimeout ([path to the project folder]/app.js:13:14)
    at listOnTimeout (internal/timers.js:537:17)
    at processTimers (internal/timers.js:481:7)
(node:89455) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)
(node:89455) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p>Node.js is warning you that an unhandled Promise rejection occurred.<br>
Furthermore, it&apos;s warning that in a future version of Node, unhandled Promise<br>
rejections will terminate the Node process (which would result in your<br>
application being stopped)!</p>
<p>Luckily, this issue is easy to deal with&#x2014;simply add a <code>try</code>/<code>catch</code> statement<br>
around your asynchronous function or method call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice that you need to add the <code>next</code> parameter to your route handler function<br>
parameter list and pass the caught error to the <code>next()</code> method in the <code>catch</code><br>
block. Passing the error to the <code>next()</code> method allows the Express default error<br>
handler process the error.</p>
<blockquote>
<p><strong>Note:</strong> When writing custom middleware functions, calling the <code>next()</code><br>
method <strong>without an argument</strong> passes control to the next middleware function.<br>
Calling the <code>next()</code> method <strong>with an argument</strong> results in Express handling<br>
the current request as an error and skipping any remaining routing and<br>
middleware functions.</p>
</blockquote>
<p>The Express default error handler is a special type of middleware function<br>
that&apos;s responsible for handling errors. In a development environment, the<br>
default error handler logs the error to the console and sends a response with an<br>
HTTP status code of <code>500 Internal Server Error</code> to the client containing the<br>
error message along with the stack trace.</p>
<p>If you test your application again, you&apos;ll see the default error handler in<br>
action as it provides details about the unhandled error that occurred after the<br>
<code>delay()</code> function has waited for the number of milliseconds that you passed in:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Error: An error has occurred!
   at Timeout._onTimeout ([path to the project folder]/app.js:13:14)
   at listOnTimeout (internal/timers.js:537:17)
   at processTimers (internal/timers.js:481:7)
</code></pre><p>If you&apos;re not using the <code>async</code>/<code>await</code> keywords, you need to call the <code>catch()</code><br>
method on the Promise returned by the <code>delay()</code> function to handle any thrown<br>
errors:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Again, notice that you need to add the <code>next</code> parameter to your route handler<br>
function parameter list and call the <code>next()</code> method passing in the error caught<br>
by the <code>catch()</code> method.</p>
<p>If you&apos;re only passing the error to the <code>next()</code> method, you can simplify your<br>
code by passing the reference to the <code>next()</code> method directly to the <code>catch()</code><br>
method call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Express is able to automatically catch errors thrown by synchronous route<br>
handlers. When performing asynchronous operations within route handlers, it&apos;s<br>
important to remember that <strong>Express is unable to catch errors thrown by<br>
asynchronous route handlers</strong>. Given that, asynchronous route handlers need to<br>
catch their own errors and pass them to the <code>next()</code> method.</p>
<blockquote>
<p><strong>Note:</strong> While all of the examples that you&apos;ve seen in this article are built<br>
around route handlers, everything that&apos;s been shown and discussed equally<br>
applies to asynchronous custom middleware functions.</p>
</blockquote>
<h2 class="mume-header" id="reducing-boilerplate-code">Reducing boilerplate code</h2>

<p>Adding a <code>try</code>/<code>catch</code> statement to each route handler function that needs to<br>
call an asynchronous function or method can result in a lot of boilerplate code.<br>
If your application only has a handful of routes that&apos;s probably not an issue,<br>
but if your application has dozens of routes (or more), it&apos;s worth taking a look<br>
at how you can reduce the amount of boilerplate code you need to write.</p>
<h3 class="mume-header" id="writing-an-asynchronous-route-handler-wrapper-function">Writing an asynchronous route handler wrapper function</h3>

<p>One approach to avoiding writing boilerplate code is to write a simple<br>
asynchronous route handler wrapper function to catch errors.</p>
<p>Start by defining a function named <code>asyncHandler</code> that accepts a reference to a<br>
route handler function and returns a function that defines three parameters,<br>
<code>req</code>, <code>res</code>, and <code>next</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Then, within the function that&apos;s being returned, call the passed in route<br>
handler function (i.e. the <code>handler</code> parameter), passing in the <code>req</code>, <code>res</code>,<br>
and <code>next</code> parameters:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>And finally, call the <code>catch()</code> method on the Promise returned from the route<br>
handler function passing in the <code>next</code> parameter:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Remember, passing the <code>next</code> parameter to the <code>catch()</code> method allows the<br>
Express default error handler to process any errors thrown by the route handler<br>
function.</p>
<p>Because each of the arrow functions return a single statement, the<br>
<code>asyncHandler()</code> function can optionally be written a little more concisely:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Note:</strong> Developers sometimes find the more concise version to be more<br>
difficult to read and understand, so if you&apos;re working on a team, talk with<br>
your teammates and determine which approach is the team&apos;s preferred approach.</p>
</blockquote>
<h3 class="mume-header" id="using-the-asynchronous-route-handler-wrapper-function">Using the asynchronous route handler wrapper function</h3>

<p>As a reminder, this is what your asynchronous route handler currently looks<br>
like:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Wrapping your asynchronous route handler with your <code>asyncHandler()</code> helper<br>
function looks like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because the <code>asyncHandler()</code> function is calling the <code>catch()</code> method on the<br>
Promise that&apos;s returned from the asynchronous route handler you can safely<br>
remove the <code>try</code>/<code>catch</code> statement. This makes asynchronous route handlers<br>
cleaner and easier to read and maintain.</p>
<blockquote>
<p><strong>Note:</strong> You might wonder how the <code>asyncHandler()</code> function can successfully<br>
call the <code>catch()</code> method after invoking the asynchronous route handler<br>
function if the route handler function doesn&apos;t explicitly return a Promise.<br>
Remember that marking a function or method with the <code>async</code> keyword results in<br>
that function or method implicitly returning a Promise. Your asynchronous<br>
route handler is marked as an <code>async</code> function, so it implicitly returns a<br>
Promise.</p>
</blockquote>
<h2 class="mume-header" id="what-you-learned-1">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>that Express cannot process unhandled Promise rejections from within a route<br>
handler (or middleware) function;</li>
<li>how to use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with<br>
<code>async</code>/<code>await</code> to properly handle errors thrown from within asynchronous<br>
route handler (or middleware) function; and</li>
<li>how to write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions.</li>
</ul>
<h2 class="mume-header" id="see-also">See also&#x2026;</h2>

<p>While writing a wrapper function for your asynchronous route handler function is<br>
easy to do, you can also use an npm package to accomplish the same thing without<br>
having to write any extra code. If you&apos;re interested to see what this looks<br>
like, check out the <a href="https://www.npmjs.com/package/express-promise-router"><code>express-promise-router</code> npm<br>
package</a>.</p>
<hr>
<h1 class="mume-header" id="handling-errors-in-express">Handling Errors in Express</h1>

<p>No matter how hard we try, we all make mistakes when writing code. If you&apos;re<br>
lucky, the coding mistake will break the execution of the application in a very<br>
obvious way&#x2014;crashing the application when testing in the local development<br>
environment. If you&apos;re unlucky, the coding mistake will go unnoticed, only to<br>
surface as an unexpected error when the application is being used by end users.</p>
<p>When an unexpected error occurs, the default error handler in Express will send<br>
a response to the browser containing the error message along with the stack<br>
trace (if you&apos;re not running in a production environment). While the default<br>
error handler might work fine in your local development environment, for most<br>
applications you&apos;ll want to create a custom error handler to precisely control<br>
how errors are handled in other environments (i.e. test, staging, or<br>
production).</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe how an error handler function differs from middleware and route<br>
handler functions;</li>
<li>Define a global error-handling function to catch and process unhandled errors;<br>
and</li>
<li>Define a route to handle requests for unknown routes by throwing a 404 NOT<br>
FOUND error.</li>
</ul>
<h2 class="mume-header" id="setting-up-an-example-express-application">Setting up an example Express application</h2>

<p>Let&apos;s create a simple application to assist with exploring how to handle errors<br>
in Express.</p>
<p>Create a folder for your project (if you haven&apos;t already), open a terminal and<br>
browse to your project folder, and run the following commands:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0 pug@^2.0.0
<span class="token function">npm</span> <span class="token function">install</span> nodemon --save-dev
</pre><blockquote>
<p><strong>Important:</strong> If you&apos;re using Git, don&apos;t forget to add a <code>.gitignore</code> file in<br>
the root of your project folder that contains an entry to ignore the<br>
<code>node_modules</code> folder! The <code>node_modules</code> folder tends to be very large and<br>
would bloat the Git repository if it was committed and pushed. Ignoring the<br>
<code>node_modules</code> folder is possible because it can be generated on demand by<br>
running the <code>npm install</code> command.</p>
</blockquote>
<p>Add an <code>app.js</code> file to the root of your project containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Next, define an npm <code>start</code> script in your <code>package.json</code> file that uses Nodemon<br>
to run the application:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
 <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;handling-errors-in-express&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;pug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.4&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p><strong>Pro Tip:</strong> Creating scripts in the <code>package.json</code> file allows you to<br>
customize and rename often used terminal commands. For example, the above<br>
<code>&quot;start&quot;: &quot;nodemon app.js&quot;</code> script allows you to run <code>npm start</code> instead of<br>
<code>npx nodemon app.js</code> in your terminal to run the application.</p>
</blockquote>
<p>The last bit of set up business is to create a couple of Pug views. Add a<br>
<code>views</code> folder to the root of the project. Then add two files to the <code>views</code><br>
folder: <code>layout.pug</code> and <code>index.pug</code>:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- layout.pug</span>

<span class="token doctype">doctype html</span>
<span class="token tag">html</span>
 <span class="token tag">head</span>
   <span class="token tag">title</span> <span class="token plain-text">Custom Error Handlers - #{title}</span>
 <span class="token tag">body</span>
   <span class="token tag">h1</span> <span class="token plain-text">Custom Error Handlers</span>
   <span class="token tag">h2</span><span class="token punctuation">=</span><span class="token code"> title</span>
   <span class="token tag">div</span>
     <span class="token keyword">block content</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">p</span> <span class="token plain-text">Welcome to the Custom Error Handlers project!</span>
</pre><p>Now you&apos;re ready to run and test your application! From the terminal, run the<br>
command <code>npm start</code>, then browse to the URL <code>http://localhost:8080/</code>. You should<br>
see the application&apos;s Home page.</p>
<h2 class="mume-header" id="the-default-error-handler-in-express">The default error handler in Express</h2>

<p>After an error is thrown or the <code>next()</code> method is called with an argument from<br>
within a route handler, Express will handle the error using its default error<br>
handler.</p>
<p>You can see the default error handler in action by starting the example<br>
application (i.e. <code>npm start</code>) and browsing to<br>
<code>http://localhost:8080/throw-error</code>. The default error handler will send a<br>
response to the browser containing the error message along with the stack trace:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Error: An error occurred!
   at throwError ([path to the project folder]/app.js:14:9)
   at [path to the project folder]/app.js:29:3
   at Layer.handle [as handle_request] ([path to the project folder]/node_modules/express/lib/router/layer.js:95:5)
   at next ([path to the project folder]/node_modules/express/lib/router/route.js:137:13)
   at Route.dispatch ([path to the project folder]/node_modules/express/lib/router/route.js:112:3)
   at Layer.handle [as handle_request] ([path to the project folder]/node_modules/express/lib/router/layer.js:95:5)
   at [path to the project folder]/node_modules/express/lib/router/index.js:281:22
   at Function.process_params ([path to the project folder]/node_modules/express/lib/router/index.js:335:12)
   at next ([path to the project folder]/node_modules/express/lib/router/index.js:275:10)
   at expressInit ([path to the project folder]/node_modules/express/lib/middleware/init.js:40:5)
</code></pre><blockquote>
<p><strong>Note:</strong> If you&apos;re following along, the placeholder text &quot;[path to the<br>
project folder]&quot; in the above error stack trace information will display the<br>
actual absolute path to your project folder.</p>
</blockquote>
<p>The response will also have an HTTP status code of <code>500 Internal Server Error</code>.<br>
You can view the response&apos;s HTTP status code by inspecting the network<br>
information using your browser&apos;s developer tools.</p>
<h3 class="mume-header" id="do-you-need-a-custom-error-handler">Do you need a custom error handler?</h3>

<p>If the <code>NODE_ENV</code> environment variable is set to &quot;production&quot;, then the default<br>
error handler will simply return a response with an HTTP status code of <code>500 Internal Server Error</code> containing the text &quot;Internal Server Error&quot;.</p>
<p>You can see this in action by setting the <code>NODE_ENV</code> environment variable before<br>
starting the example application:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">NODE_ENV<span class="token operator">=</span>production node app.js
</pre><p><img src="images/express-default-error-handler-in-production.png" alt="express-default-error-handler-in-production"></p>
<p>If an end user were to see the above error message in production, it would<br>
likely leave them frustrated and confused. While a custom error handler won&apos;t be<br>
able to magically resolve unexpected errors for your users, it will allow you to<br>
display a friendlier message using your website&apos;s layout template (you&apos;ll see<br>
how to do this later in this article).</p>
<p>Defining a custom error handler will also allow you to log unexpected errors so<br>
that you (or someone on your team) can review them periodically to determine if<br>
an undetected bug has made its way into production.</p>
<h2 class="mume-header" id="defining-a-custom-error-handler">Defining a custom error handler</h2>

<p>As you&apos;ve seen in earlier lessons, Express middleware functions define three<br>
parameters (<code>req</code>, <code>res</code>, <code>next</code>) and route handlers define two or three<br>
parameters (<code>req</code>, <code>res</code>, and optionally the <code>next</code> parameter):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Middleware function.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from a middleware function!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Route handler function.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from a route handler function!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Error handling functions look the same as middleware functions except they<br>
define four parameters instead of three&#x2014;<code>err</code>, <code>req</code>, <code>res</code>, and <code>next</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Custom error handler functions have to define four parameters otherwise Express<br>
won&apos;t recognize the function as an error handler. Route handler function<br>
definitions can omit the <code>next</code> parameter if it&apos;s not going to be used; error<br>
handler functions have to include the <code>next</code> parameter.</p>
<p>Define error handler functions after all other calls to <code>app.use()</code> and all of<br>
your application&apos;s route definitions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This ensures that your custom error handler will get called to handle errors<br>
from any of your application&apos;s middleware or route handler functions.</p>
<p>If you test your custom error handler by browsing to<br>
<code>http://localhost:8080/throw-error</code> you&apos;ll see that it sends a response<br>
containing the text &quot;An error occurred!&quot;.</p>
<p>If you use your browser&apos;s developer tools to inspect the response of<br>
<code>http://localhost:8080/throw-error</code>, you&apos;ll notice that the response HTTP status<br>
code is <code>200 OK</code>, which is the default status code used by Express when sending<br>
responses. You can use the <code>res.status()</code> method to set a different status code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how the <code>err.status</code> property is checked to see if it has a value before<br>
the status is set to the literal numeric value <code>500</code>. Giving priority to the<br>
<code>err.status</code> property allows code elsewhere in the application to throw an error<br>
that includes the specific HTTP status code to send to the client.</p>
<p>You can return an HTML response instead of plain text by rendering a Pug view:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
   message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
   error<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Be sure to add the <code>error.pug</code> view to the <code>views</code> folder:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- error.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> message <span class="token operator">||</span> <span class="token string">&apos;An unexpected error occurred on the server.&apos;</span></span>
 <span class="token flow-control"><span class="token branch keyword">if</span> stack</span>
   <span class="token tag">h3</span> <span class="token plain-text">Stack Trace</span>
   <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> stack</span>
</pre><p>Notice that the error <code>message</code> and <code>stack</code> properties are only being passed to<br>
the view if the <code>NODE_ENV</code> environment variable isn&apos;t set to &quot;production&quot;. For<br>
security reasons, it&apos;s important to avoid leaking potentially sensitive<br>
information about your application.</p>
<p>If you test your custom error handler again by browsing to<br>
<code>http://localhost:8080/throw-error</code> you&apos;ll see that it sends an HTML response<br>
containing information about the error that was thrown.</p>
<p>To test how the error handler will behave in the production environment, set the<br>
<code>NODE_ENV</code> environment variable to &quot;production&quot; before starting the example<br>
application:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">NODE_ENV<span class="token operator">=</span>production node app.js
</pre><h3 class="mume-header" id="defining-multiple-custom-error-handlers">Defining multiple custom error handlers</h3>

<p>Express allows you to define more than one custom error handler which is useful<br>
if you need to handle specific types of errors differently. It&apos;s also useful for<br>
creating an error handler to perform a specific error handling task. Let&apos;s look<br>
at an example of defining a second error handler that&apos;s responsible for logging<br>
errors.</p>
<p>Error handlers, like route handlers, are executed by Express in the order that<br>
they&apos;re defined in, so defining a new error handler before the existing handler<br>
ensures that it&apos;ll be called first:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The new error handler simply uses the <code>console.error()</code> method to log errors to<br>
the console, provided that the <code>NODE_ENV</code> environment variable isn&apos;t set to<br>
&quot;production&quot;. In the production environment, there&apos;s a TODO comment to log the<br>
error to the database. The <code>console.error()</code> method call in the existing error<br>
handler was removed; logging errors is now the responsibility of the new error<br>
handler.</p>
<blockquote>
<p><strong>Note:</strong> Logging errors to a database&#x2014;or another type of data store&#x2014;is a<br>
common practice in production environments. Doing this allows a developer or<br>
system administrator to periodically review a log of application errors to<br>
determine if there are any issues that might need to be looked at in more<br>
detail. There are many ways to handle error logging, ranging from npm logging<br>
packages (e.g. <a href="https://www.npmjs.com/package/winston"><code>winston</code></a>) to full-blown application<br>
monitoring cloud-based services.</p>
</blockquote>
<p>Also notice that the new error handler calls the <code>next()</code> method passing in the<br>
<code>err</code> parameter (the current error) which passes control to the next error<br>
handler. An error handler needs to call <code>next()</code> or return a response. Failing<br>
to do this will result in the request &quot;hanging&quot; and consuming resources on the<br>
server.</p>
<h2 class="mume-header" id="handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</h2>

<p>A common feature for applications to implement is to present a friendly &quot;Page<br>
Not Found&quot; message to end users when a request can&apos;t be matched to one of the<br>
application&apos;s defined routes. Let&apos;s see how to implement this feature using a<br>
combination of a middleware function and an error handler function.</p>
<p>First, add a new middleware function after the last route in your application<br>
(but before any of your error handlers):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
 <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Placing this middleware function after all of your routes means that this<br>
middleware function will only be invoked if a request fails to match any of your<br>
routes.</p>
<p>Notice that the middleware function creates a new Error object and sets a<br>
<code>status</code> property on the object to the literal number <code>404</code>. <code>404</code> is the HTTP<br>
status code for &quot;Not Found&quot; responses indicating that the requested resource<br>
could not be found.</p>
<p>After setting the <code>status</code> property, the <code>next()</code> method is called with the<br>
<code>err</code> variable passed as an argument. Remember that calling the <code>next()</code> method<br>
with an argument results in Express handling the current request as an error and<br>
skipping any remaining routing and middleware functions.</p>
<p>At this point, you can test your &quot;Page Not Found&quot; middleware function by<br>
browsing to <code>http://localhost:8080/some-unknown-page</code> (or really any path that<br>
doesn&apos;t match one of your application&apos;s configured routes). You should see your<br>
&quot;Server Error&quot; page displaying the message &quot;The requested page couldn&apos;t be<br>
found.&quot;</p>
<h3 class="mume-header" id="creating-a-page-not-found-page">Creating a &quot;Page Not Found&quot; page</h3>

<p>While the current solution works, a more elegant solution would be to present a<br>
specific &quot;Page Not Found&quot; page to the end user.</p>
<p>To do this, define another error handler&#x2014;in between the logging and generic<br>
error handlers&#x2014;for handling 404 errors:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This error handler starts by checking if the <code>err.status</code> property is set to<br>
<code>404</code>&#x2014;which indicates that the current error is a &quot;Not Found&quot; error. If the<br>
current error is a &quot;Not Found&quot; error, then it sets the response HTTP status code<br>
to <code>404</code> and calls the <code>res.render()</code> method to render the <code>page-not-found</code> view<br>
(you&apos;ll create that view in just a bit). Otherwise, the <code>next()</code> method is<br>
called with the <code>err</code> parameter passed as an argument, which passes control to<br>
the next error handler.</p>
<p>Before testing your new error handler, don&apos;t forget to add a new view named<br>
<code>page-not-found.pug</code> to the <code>views</code> folder with the following content:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- page-not-found.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span> <span class="token plain-text">Sorry, we couldn&apos;t find the page that you requested.</span>
</pre><p>Now if you test your application again by browsing to<br>
<code>http://localhost:8080/some-unknown-page</code> (or any path that doesn&apos;t match one of<br>
your application&apos;s configured routes) you should see your new &quot;Page Not Found&quot;<br>
page.</p>
<p>For your reference, here&apos;s the final version of the <code>app.js</code> file:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="what-you-learned-2">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>how an error handler function differs from middleware and route handler<br>
functions;</li>
<li>how to define a global error-handling function to catch and process unhandled<br>
errors; and</li>
<li>how to define a route to handle requests for unknown routes by throwing a 404<br>
NOT FOUND error.</li>
</ul>
<hr>
<h1 class="mume-header" id="data-driven-websites-part-1-setting-up-the-project">Data-Driven Websites - Part 1: Setting Up the Project</h1>

<p>Data-driven websites are everywhere online. From e-commerce websites to search<br>
websites to mega social media websites, data is the foundation of the dynamic,<br>
personalized experiences that users have come to expect of the Web.</p>
<p>You&apos;ve learned all of the necessary skills&#x2014;now it&apos;s time to bring it all<br>
together to create a data-driven website using Express!</p>
<p>Over the next three articles, you&apos;ll create a data-driven Reading List website<br>
that will allow you to view a list of books, add a book to the list, update a<br>
book in the list, and delete a book from the list. In this article, you&apos;ll set<br>
up the project. In the next article, you&apos;ll learn how to integrate Sequelize<br>
with an Express application. In the last article, you&apos;ll create the routes and<br>
views to perform CRUD (create, read, update, and delete) operations using<br>
Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Split the Express application and HTTP server into separate modules;</li>
<li>Use the <code>morgan</code> npm package to log requests; and</li>
<li>Add support for the Bootstrap front-end component library to your<br>
application&apos;s Pug layout template.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Setting up a new Express project;</li>
<li>Stubbing out an Express application;</li>
<li>Adding custom error handlers to an Express application; and</li>
<li>Configuring environment variables.</li>
</ul>
<h2 class="mume-header" id="setting-up-the-project">Setting up the project</h2>

<p>First things first, create a folder for your project. If you&apos;re using source<br>
control (and you are&#x2014;right?), open a terminal, browse to your project folder,<br>
and initialize your Git repository by running the command <code>git init</code>.</p>
<p>You&apos;ll be using npm to install packages in just a bit, so be sure to add a<br>
<code>.gitignore</code> file to the root of your project. Then add the entry<br>
<code>node_modules/</code> to the <code>.gitignore</code> file so that the <code>node_modules</code> folder<br>
(where npm downloads packages to) won&apos;t be tracked by Git.</p>
<blockquote>
<p><strong>Pro Tip:</strong> While configuring Git to not track the <code>node_modules</code> folder is<br>
important to do, it&apos;s not necessarily the only thing you want to configure Git<br>
not to track. For a more comprehensive <code>.gitignore</code> file for Node.js projects,<br>
you can use <a href="https://github.com/github/gitignore/blob/master/Node.gitignore">GitHub&apos;s <code>.gitignore</code> file for Node.js projects</a>.</p>
</blockquote>
<h3 class="mume-header" id="initializing-npm-and-installing-dependencies">Initializing npm and installing dependencies</h3>

<p>Before you stub out the application, use npm to initialize your project and<br>
install the following dependencies:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0 pug@^2.0.0
</pre><p>Then install Nodemon as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> nodemon@^2.0.0 --save-dev
</pre><h2 class="mume-header" id="stubbing-out-the-application">Stubbing out the application</h2>

<p>Now it&apos;s time to stub out the application by writing the minimal amount of code<br>
to define the route for the default route (i.e. the &quot;Home&quot; page).</p>
<p>Start with adding a <code>routes</code> module by adding a file named <code>routes.js</code> to the<br>
root of your project containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>The default route renders the <code>index</code> view which you&apos;ll create in just a bit.</p>
<p>Next, add the <code>app</code> module (<code>app.js</code>) to the root of your project containing the<br>
following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To stub out the initial views for the application, add a folder named <code>views</code> to<br>
the root of the project. Then add two Pug templates to the <code>views</code><br>
folder&#x2014;<code>layout.pug</code> and <code>index.pug</code> containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/layout.pug</span>

<span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span> <span class="token plain-text">Reading List - #{title}</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span> <span class="token plain-text">Reading List</span>
    <span class="token tag">div</span>
      <span class="token tag">h2</span> <span class="token plain-text">#{title}</span>
      <span class="token keyword">block content</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
</pre><p>The <code>layout.pug</code> template provides the overall HTML for each page in the<br>
application while the <code>index.pug</code> template provides the HTML for the index or<br>
default page for the application.</p>
<p>All four of these files&#x2014;<code>routes.js</code>, <code>app.js</code>, <code>layout.pug</code>, and<br>
<code>index.pug</code>&#x2014;will evolve and change as you add features to the Reading List<br>
application.</p>
<h3 class="mume-header" id="testing-the-initial-application-setup">Testing the initial application setup</h3>

<p>It&apos;s time to test your initial application setup before you make any further<br>
changes.</p>
<p>Open the <code>package.json</code> file and replace the placeholder npm <code>test</code> script (that<br>
was generated by npm) with the following <code>start</code> script:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
<span class="token punctuation">}</span>
</pre><p>From the terminal, run the command <code>npm start</code> to start your application, then<br>
browse to <code>http://localhost:8080/</code>. You should see the &quot;Home&quot; page displaying<br>
the message &quot;Hello from the Reading List app!&quot;</p>
<blockquote>
<p><strong>Now is a good time to commit your changes (if you haven&apos;t already)!</strong> In<br>
general, making smaller commits more often where each commit contains a<br>
related set of changes is better than waiting until the end of the day to make<br>
one giant commit that contains all of the changes for the entire day.</p>
</blockquote>
<h2 class="mume-header" id="splitting-the-application-and-server-into-separate-modules">Splitting the application and server into separate modules</h2>

<p>Now that you&apos;ve created a simple, initial version of the application, it&apos;s time<br>
to start adding additional features and making general improvements to the<br>
overall design of the application.</p>
<p>Up until this point, you&apos;ve created your Express application and started the<br>
HTTP server within the same module&#x2014;the <code>app</code> module. A common practice is to<br>
separate the application and server into separate modules. Doing this has the<br>
following benefits:</p>
<ul>
<li><strong>Improved separation of concerns:</strong> As much as possible, each module in your<br>
application should be responsible for doing one thing and only one thing.<br>
Separating out the server setup and startup into its own module improves the<br>
overall separation of concerns by allowing the <code>app</code> module to only be<br>
responsible for creating the Express application.</li>
<li><strong>Improved testability:</strong> Removing the startup of the HTTP server from the<br>
<code>app</code> module improves the testability of the Express application. While you<br>
won&apos;t be writing tests for your Express application in this project,<br>
establishing good coding practices will set you up to write tests for your<br>
application in the future.</li>
</ul>
<h3 class="mume-header" id="updating-the-app-module">Updating the <code>app</code> module</h3>

<p>The last two statements in the <code>app</code> module (<code>app.js</code>) are responsible for<br>
defining a port and starting the server listening for HTTP connections:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Go ahead and remove that code. In its place, add this line of code to export the<br>
Express application from the module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>For reference, here&apos;s what the complete <code>app</code> module should look like at this<br>
point:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="defining-a-new-entry-point-for-the-application">Defining a new entry point for the application</h3>

<p>As a reminder, the npm <code>start</code> script currently looks like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
<span class="token punctuation">}</span>
</pre><p>Nodemon is being used to start the application and to restart the application<br>
when a change is made to any of the files in the project. The <code>app.js</code> file is<br>
provided as the entry point for the application&#x2014;the module that&apos;s responsible<br>
for configuring and starting the application.</p>
<p>Now that the <code>app</code> module doesn&apos;t start the server listening for HTTP<br>
connections, it can no longer be used as the entry point for the application. To<br>
create a new entry point for the application, add a folder named <code>bin</code> to the<br>
root of the project. Then add a file named <code>www</code> (with no <code>.js</code> extension)<br>
containing the following code. Make sure <code>#!/usr/bin/env node</code> is on the first<br>
line of your file:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the npm <code>start</code> script to pass the <code>www</code> file into Nodemon as the<br>
entry point:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon ./bin/www&quot;</span>
<span class="token punctuation">}</span>
</pre><p>To test your application&apos;s new entry point, run the command <code>npm start</code>, then<br>
browse to <code>http://localhost:8080/</code>. As before, you should see the &quot;Home&quot; page<br>
displaying the message &quot;Hello from the Reading List app!&quot;</p>
<h3 class="mume-header" id="taking-a-closer-look-at-the-binwww-file">Taking a closer look at the <code>./bin/www</code> file</h3>

<p>The <code>bin</code> folder is a common Unix convention for naming a folder that contains<br>
executable scripts. Even though it&apos;s lacking the <code>.js</code> file extension, the <code>www</code><br>
file is actually a JavaScript module that contains the code to start up the<br>
Express application.</p>
<p>You might have noticed that the first line of the <code>www</code> file isn&apos;t valid<br>
JavaScript:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
</pre><p>This is an instance of a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">Unix shebang</a>. The shebang has to<br>
be written on the first line of the <code>www</code> file. It tells the system what<br>
interpreter to pass the file to for execution. In this case, <code>node</code> is specified<br>
as the interpreter via the Unix <code>env</code> command.</p>
<p>The intention of the <code>./bin/www</code> file is for it to be an executable<br>
script&#x2014;meaning that you could start the application by simply entering the file<br>
name in the terminal as a command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">bin/www
</pre><p>If you attempt to execute the script, you&apos;ll receive a &quot;permission denied&quot;<br>
error. Text files by default do not have the necessary permissions. You can use<br>
the <code>chmod</code> command in the root of your project to add the missing permissions:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">chmod</span> +x bin/www
</pre><p>With the proper permissions added, you can run the command <code>bin/www</code> to start<br>
your application.</p>
<blockquote>
<p><strong>Note:</strong> The ability to run your application via a <code>bin</code> script is primarily<br>
useful for Node projects that are intended to be used as command line tools or<br>
utilities. The Sequelize CLI is an example of a Node.js command line tool<br>
that&apos;s executable via a <code>bin</code> folder script. For Express applications like the<br>
Reading List application, it&apos;s far more common to use an npm <code>start</code> script to<br>
run the application.</p>
</blockquote>
<h2 class="mume-header" id="logging-requests-using-morgan">Logging requests using Morgan</h2>

<p>Currently, after the application starts up and displays the message &quot;Listening<br>
on port 8080...&quot;, nothing else is written to the console to show activity. To<br>
assist with testing and debugging, you can install the <code>morgan</code> npm package, an<br>
HTTP request logger middleware for Node.js and Express:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> morgan
</pre><p>Aftering installing <code>morgan</code>, import it into the <code>app</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;morgan&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Code organization tip:</strong> Notice how the external modules are imported first<br>
and grouped together followed by the imported internal modules. While this<br>
isn&apos;t a hard requirement, it can help make it easier to read a module&apos;s<br>
dependencies.</p>
</blockquote>
<p>Then call the <code>app.use()</code> method to add <code>morgan</code> to the application request<br>
pipeline:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&apos;dev&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The string literal &quot;dev&quot; is passed into <code>morgan</code> to configure the request<br>
logging format. The &quot;dev&quot; format is just one of the available predefined<br>
formats.</p>
<p>Now if you start your application and browse to <code>http://localhost:8080/</code>, you&apos;ll<br>
see the request logged to the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">GET / 200 9.851 ms - 172
</pre><p>Here&apos;s a breakdown of the above output:</p>
<ul>
<li><code>GET</code> - The request HTTP method</li>
<li><code>/</code> - The request path</li>
<li><code>9.851 ms</code> - The response time in milliseconds</li>
<li><code>172</code> - The <code>Content-Length</code> response header value that indicates the size of<br>
the response body in bytes</li>
</ul>
<h2 class="mume-header" id="adding-custom-error-handlers">Adding custom error handlers</h2>

<p>As you learned in a previous article, Express provides a default error handler,<br>
but for most applications you&apos;ll want to create a custom error handler to<br>
precisely control how errors are handled.</p>
<p>In the <code>app</code> module, start with adding a middleware function to catch unmatched<br>
requests and throw a &quot;Page Not Found&quot; error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token comment">// Code remove for brevity.</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// TODO Add custom error handlers.</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>Next, add the following custom error handlers&#x2014;an error handler to log errors, an<br>
error handler to handle &quot;Page Not Found&quot; errors, and a generic error handler:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token comment">// Code remove for brevity.</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>To complete your custom error handlers, add two views to the <code>views</code><br>
folder&#x2014;<code>error.pug</code> and <code>page-not-found.pug</code>:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- error.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> message <span class="token operator">||</span> <span class="token string">&apos;An unexpected error occurred on the server.&apos;</span></span>
 <span class="token flow-control"><span class="token branch keyword">if</span> stack</span>
   <span class="token tag">h3</span> <span class="token plain-text">Stack Trace</span>
   <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> stack</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- page-not-found.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span> <span class="token plain-text">Sorry, we couldn&apos;t find the page that you requested.</span>
</pre><h3 class="mume-header" id="testing-your-custom-error-handlers">Testing your custom error handlers</h3>

<p>To test your custom error handlers, update the default route (<code>/</code>) in the<br>
<code>routes</code> module to temporarily throw an error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;This is a test error!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Start your application and browse to <code>http://localhost:8080/</code> and you should see<br>
the &quot;Server Error&quot; page. Next, browse to an unknown path like<br>
<code>http://localhost:8080/asdf</code> and you should see the &quot;Page Not Found&quot; page.</p>
<p>You should also see the errors logged to the terminal:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Error: This is a <span class="token function">test</span> error<span class="token operator">!</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/routes.js:7:9
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/route.js:137:13<span class="token punctuation">)</span>
    at Route.dispatch <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/route.js:112:3<span class="token punctuation">)</span>
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:281:22
    at Function.process_params <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:335:12<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:275:10<span class="token punctuation">)</span>
    at Function.handle <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:174:3<span class="token punctuation">)</span>
    at router <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:47:12<span class="token punctuation">)</span>
GET / 500 452.308 ms - 2070
</pre><pre data-role="codeBlock" data-info="sh" class="language-bash">Error: The requested page couldn&apos;t be found.
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/app.js:16:15
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at trim_prefix <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:317:13<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:284:7
    at Function.process_params <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:335:12<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:275:10<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:635:15
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:260:14<span class="token punctuation">)</span>
    at Function.handle <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:174:3<span class="token punctuation">)</span>
    at router <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:47:12<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  status: 404
<span class="token punctuation">}</span>
GET /asdf 404 15.648 ms - 223
</pre><p>Also notice that thanks to the request logging provided by the <code>morgan</code><br>
middleware, you can see the <code>500</code> (Internal Server Error) and <code>404</code> (Not Found)<br>
HTTP response status codes returned by the server.</p>
<p>After confirming that your custom error handlers work as expected, be sure to<br>
remove the code that you temporarily added to your default route!</p>
<blockquote>
<p>For a refresher on the custom error handlers, see the &quot;Catching and Handling<br>
Errors in Express&quot; article.</p>
</blockquote>
<h2 class="mume-header" id="configuring-environment-variables">Configuring environment variables</h2>

<p>Since the Reading List application will use a database for data persistence,<br>
your project needs to include a way to configure the database connection<br>
settings across environments. To do that, let&apos;s use environment variables to<br>
configure the application.</p>
<blockquote>
<p>For a refresher on how to use environment variables within an Express<br>
application, see the &quot;Acclimating to Environment Variables&quot; article.</p>
</blockquote>
<p>To start, install <code>per-env</code> as a project dependency the <code>dotenv</code> and<br>
<code>dotenv-cli</code> as development dependencies (i.e. dependencies that are only needed<br>
in development environments):</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> per-env
<span class="token function">npm</span> <span class="token function">install</span> dotenv dotenv-cli --save-dev
</pre><p>As a reminder, the <code>per-env</code> package allows you to define npm scripts for each<br>
of your application&apos;s environments. The <code>dotenv</code> package is used to load<br>
environment variables from an <code>.env</code> file and the <code>dotenv-cli</code> package acts as<br>
an intermediary between npx and tools or utilities (like the Sequelize CLI) to<br>
load your environment variables from an <code>.env</code> file and run the command that you<br>
pass into it.</p>
<h3 class="mume-header" id="adding-the-env-and-envexample-files">Adding the <code>.env</code> and <code>.env.example</code> files</h3>

<p>Next, add two files to the root of your project&#x2014;<code>.env</code> and <code>.env.example</code> with<br>
the following content:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt"><code>PORT=8080
</code></pre><p>The <code>.env</code> file is where you define the environment variables to configure your<br>
application. At this point in the project, you just need to define the <code>PORT</code><br>
environment variable. The <code>.env</code> file shouldn&apos;t be committed to source control<br>
as the environment variables it defines are specific to your development<br>
environment. Additionally, it might contain sensitive information.</p>
<blockquote>
<p>To ensure that the <code>.env</code> file isn&apos;t committed to source control, add <code>.env</code><br>
as an entry to your project&apos;s <code>.gitignore</code> file. If you&apos;re using GitHub&apos;s<br>
<code>.gitignore</code> file for Node.js projects, this has already been done for you.</p>
</blockquote>
<p>Because the <code>.env</code> file isn&apos;t committed to source control, the <code>.env.example</code><br>
file serves as documentation for your teammates so they can create their own<br>
<code>.env</code> files.</p>
<h3 class="mume-header" id="adding-the-config-module">Adding the <code>config</code> module</h3>

<p>Let&apos;s encapsulate all of the <code>process.env</code> property access into a single<br>
<code>config</code> module by importing all of the application&apos;s environment variables and<br>
exporting them to make them available to the rest of the application.</p>
<p>Add a folder named <code>config</code> to the root of the project. Then add a file named<br>
<code>index.js</code> to the <code>config</code> folder containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Now you can update the <code>./bin/www</code> file to get the port from the <code>config</code><br>
module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start listening for connections.</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-npm-start-script">Updating the npm <code>start</code> script</h3>

<p>To load the environment variables from the <code>.env</code> file in the local development<br>
environment while ignoring the <code>.env</code> file in the production environment, update<br>
the <code>package.json</code> file <code>scripts</code> section:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;per-env&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start:development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon -r dotenv/config ./bin/www&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start:production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./bin/www&quot;</span>
<span class="token punctuation">}</span>
</pre><p>To review, if the <code>NODE_ENV</code> environment variable is set to <code>production</code>, then<br>
running the <code>start</code> script will result in the execution of the<br>
<code>start:production</code> script. If the <code>NODE_ENV</code> variable isn&apos;t defined (or set to<br>
<code>development</code>), then the <code>start:development</code> script will be executed by default.</p>
<p>At this point, running the command <code>npm start</code> should start your application<br>
just like it before.</p>
<h3 class="mume-header" id="supporting-debugging-in-visual-studio-code">Supporting debugging in Visual Studio Code</h3>

<p>To use the debugger in Visual Studio Code, configure it to load your environment<br>
variables from your <code>.env</code> file. Open the <code>launch.json</code> file located in the<br>
<code>.vscode</code> folder and add the <code>envFile</code> property to your Node configuration:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
 <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/bin/www&quot;</span><span class="token punctuation">,</span>
     &quot;envFile<span class="token string">&quot;: &quot;</span>$<span class="token punctuation">{</span>workspaceFolder<span class="token punctuation">}</span>/.env&quot;
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p><strong>Note:</strong> If you don&apos;t have <code>.vscode/launch.json</code> file in your project, see<br>
<a href="https://code.visualstudio.com/docs/editor/debugging#_launch-configurations">this page</a> in the Visual Studio Code<br>
documentation for instructions on how to set up debugging.</p>
</blockquote>
<h2 class="mume-header" id="setting-up-bootstrap">Setting up Bootstrap</h2>

<p>One last bit of project set up work before installing and configuring Sequelize!<br>
Update the <code>views/layout.pug</code> view with the following Bootstrap template markup:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">charset</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;utf-8&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;viewport&apos;</span> content<span class="token operator">=</span>&apos;width<span class="token operator">=</span>device<span class="token operator">-</span>width</span><span class="token punctuation">,</span> <span class="token attr-name">initial-scale</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token number">1</span></span><span class="token punctuation">,</span> <span class="token attr-name">shrink-to-fit</span><span class="token punctuation">=</span><span class="token attr-value">no&apos;</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">link<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">rel</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;stylesheet&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">title</span> <span class="token plain-text">Reading List - #{title}</span>
  <span class="token tag">body</span>
    <span class="token tag">nav<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;navbar navbar-expand-lg navbar-dark bg-primary&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;navbar-brand&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Reading List</span>
    <span class="token tag">.container</span>
      <span class="token tag">h2<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">#{title}</span>
      <span class="token keyword">block content</span>
    <span class="token tag">script<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">src</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;https://code.jquery.com/jquery-3.4.1.slim.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token script"><span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&apos;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span><span class="token punctuation">)</span> <span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&apos;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span><span class="token punctuation">)</span></span>
</pre><p>Adding support for the Bootstrap front-end component library will give the<br>
Reading List application a nice, polished look. The above markup was taken<br>
directly from <a href="https://getbootstrap.com/docs/4.4/getting-started/introduction/#starter-template">the starter template published in the official Bootstrap<br>
documentation</a>.</p>
<blockquote>
<p>Adding Bootstrap won&apos;t change the look of the application much at this point.<br>
Later on, once you start adding forms to the application, it&apos;ll be easier to<br>
notice the benefits of using a library like Bootstrap.</p>
</blockquote>
<h2 class="mume-header" id="what-you-learned-3">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Split the Express application and HTTP server into separate modules;</li>
<li>Use the <code>morgan</code> npm package to log requests; and</li>
<li>Add support for the Bootstrap front-end component library to your<br>
application&apos;s Pug layout template.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Setting up a new Express project;</li>
<li>Stubbing out an Express application;</li>
<li>Adding custom error handlers to an Express application; and</li>
<li>Configuring environment variables.</li>
</ul>
<p>Next up: integrating Sequelize with an Express application!</p>
<hr>
<h1 class="mume-header" id="data-driven-websites-project-part-2-integrating-sequelize-with-express">Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</h1>

<p>Welcome to part two of creating the data-driven Reading List website!</p>
<p>Over the course of three articles, you&apos;ll create a data-driven Reading List<br>
website that will allow you to view a list of books, add a book to the list,<br>
update a book in the list, and delete a book from the list. In the first<br>
article, you created the project. In this article, you&apos;ll learn how to integrate<br>
Sequelize with an Express application. In the last article, you&apos;ll create the<br>
routes and views to perform CRUD (create, read, update, and delete) operations<br>
using Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Install and configure Sequelize within an Express application; and</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Using the Sequelize CLI to create a model and migration;</li>
<li>Using the Sequelize CLI to seed the database; and</li>
<li>Using Sequelize to query data from the database.</li>
</ul>
<h2 class="mume-header" id="installing-and-configuring-sequelize">Installing and configuring Sequelize</h2>

<p>First things first, you need to install and configure Sequelize!</p>
<p>Use npm to install the following dependencies:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> sequelize@^5.0.0 pg@^8.0.0
</pre><p>Then install the Sequelize CLI as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> sequelize-cli@^5.0.0 --save-dev
</pre><h3 class="mume-header" id="configuring-the-sequelize-cli">Configuring the Sequelize CLI</h3>

<p>Before using the Sequelize CLI to initialize Sequelize within your project, add<br>
a file named <code>.sequelizerc</code> to the root of your project containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&apos;config&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;config&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;database.js&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;models-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;seeders-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;seeders&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;migrations-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;migrations&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>.sequelizerc</code> file configures the Sequelize CLI so that it knows:</p>
<ul>
<li>Where your database configuration is located; and</li>
<li>Where to generate the <code>models</code>, <code>seeders</code>, and <code>migrations</code> folders.</li>
</ul>
<h3 class="mume-header" id="initializing-sequelize">Initializing Sequelize</h3>

<p>Now you&apos;re ready to initialize Sequelize by running the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize init
</pre><p>When the command completes, your project should now contain the following:</p>
<ul>
<li>The <code>config/database.js</code> file;</li>
<li>The <code>db/migrations</code>, <code>db/models</code>, and <code>db/seeders</code> folders; and</li>
<li>The <code>db/models/index.js</code> file.</li>
</ul>
<h3 class="mume-header" id="creating-a-new-database-and-database-user">Creating a new database and database user</h3>

<p>To prepare for configuring Sequelize, you need to create a new database for the<br>
Reading List application to use and a new normal or limited user (i.e. a user<br>
without superuser privileges) that has permissions to access the new database.</p>
<p>Open psql by running the command <code>psql</code> (to use the currently logged in user) or<br>
<code>psql -U &#xAB;super user username&#xBB;</code> to specify the username of the super user to<br>
use. Then execute the following SQL statements:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> reading_list<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> reading_list_app <span class="token keyword">with</span> encrypted password <span class="token string">&apos;&#xAB;a strong password for the reading_list_app user&#xBB;&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token keyword">database</span> reading_list <span class="token keyword">to</span> reading_list_app<span class="token punctuation">;</span>
</pre><p>Make note of the password that you use as you&apos;ll need them for the next step in<br>
the configuration process!</p>
<blockquote>
<p>To review how to create a new PostgreSQL database and user, see the &quot;Database<br>
Management Walk-Through&quot; and &quot;User Management Walk-Through&quot; readings in the<br>
SQL lesson.</p>
</blockquote>
<h3 class="mume-header" id="adding-the-database-environment-variables">Adding the database environment variables</h3>

<p>Now you&apos;re ready to add the <code>DB_USERNAME</code>, <code>DB_PASSWORD</code>, <code>DB_DATABASE</code>, and<br>
<code>DB_HOST</code> environment variables to the <code>.env</code> and <code>.env.example</code> files:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=reading_list_app
DB_PASSWORD=&#xAB;the reading_list_app user password&#xBB;
DB_DATABASE=reading_list
DB_HOST=localhost
</code></pre><p>Next, update the <code>config</code> module (the <code>config/index.js</code> file) with the following<br>
code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./config/index.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_USERNAME</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_DATABASE</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_HOST</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Remember that the <code>config</code> module is responsible for providing access to your<br>
application&apos;s environment variables. Any part of the application that needs<br>
access to the <code>DB_USERNAME</code>, <code>DB_PASSWORD</code>, <code>DB_DATABASE</code>, and <code>DB_HOST</code><br>
environment variables can use the <code>username</code>, <code>password</code>, <code>database</code>, and <code>host</code><br>
properties on the <code>config</code> module&apos;s <code>db</code> object.</p>
<h3 class="mume-header" id="configuring-the-sequelize-database-connection">Configuring the Sequelize database connection</h3>

<p>Now you&apos;re ready to configure the database connection for Sequelize! Update the<br>
<code>config/database.js</code> file with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>
  username<span class="token punctuation">,</span>
  password<span class="token punctuation">,</span>
  database<span class="token punctuation">,</span>
  host<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>db<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
    database<span class="token punctuation">,</span>
    host<span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&apos;postgres&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The first statement uses the <code>require()</code> function to import the <code>config/index</code><br>
module. Destructuring is used to declare the <code>username</code>, <code>password</code>, <code>database</code>,<br>
and <code>host</code> variables and initialize them to the values of the corresponding<br>
property names on the <code>config</code> module&apos;s <code>db</code> property.</p>
<p>You could remove the destructuring by refactoring the above statement into the<br>
following statements:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> config<span class="token punctuation">.</span>db<span class="token punctuation">;</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> db<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> db<span class="token punctuation">.</span>password<span class="token punctuation">;</span>
<span class="token keyword">const</span> database <span class="token operator">=</span> db<span class="token punctuation">.</span>database<span class="token punctuation">;</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> db<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
</pre><p>The <code>config/database</code> module then exports an object with a property named<br>
<code>development</code> set to an object literal with <code>username</code>, <code>password</code>, <code>database</code>,<br>
<code>host</code>, and <code>dialect</code> properties:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
    database<span class="token punctuation">,</span>
    host<span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&apos;postgres&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>development</code> property name indicates that these configuration settings are<br>
for the <code>development</code> environment. The <code>username</code>, <code>password</code>, <code>database</code>,<br>
<code>host</code>, and <code>dialect</code> property names are the Sequelize options used to configure<br>
the database connection.</p>
<blockquote>
<p>For a complete list of the available Sequelize options, see <a href="https://sequelize.org/master/class/lib/sequelize.js~Sequelize.html#instance-constructor-constructor">the official<br>
Sequelize API documentation</a>.</p>
</blockquote>
<h2 class="mume-header" id="testing-the-connection-to-the-database">Testing the connection to the database</h2>

<p>You&apos;ve configured Sequelize&#x2014;specifically the database connection&#x2014;but how do you<br>
know if Sequelize can actually connect to the database? The Sequelize instance<br>
method <code>authenticate()</code> can be used to test the connection to the database by<br>
attempting to execute the query <code>SELECT 1+1 AS result</code> against the database<br>
specified in the <code>config/database</code> module.</p>
<p>The Reading List application is a data-driven website, so it&apos;ll be heavily<br>
dependent on its database. Given that, it&apos;s best to test the connection to the<br>
database as early as possible. You can do that by updating the <code>./bin/www</code> file<br>
to test the connection to the database before starting the application listening<br>
for HTTP connections.</p>
<p>Update the <code>./bin/www</code> file with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection success! Sequelize is ready to use...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Start listening for connections.</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection failure.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In addition to importing the <code>app</code> module, the <code>require()</code> function is called to<br>
import the <code>./db/models</code> module&#x2014;a module that was generated by the Sequelize CLI<br>
when you initialized your project to use Sequelize.</p>
<p>The <code>./db/models</code> module provides access to the Sequelize instance via the<br>
<code>sequelize</code> property. The <code>authenticate()</code> method is called on the Sequelize<br>
instance. The <code>authenticate()</code> method is asynchronous, so it returns a Promise<br>
that will resolve if the connection to the database is successful, otherwise it<br>
will be rejected:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The connection to the database succeeded.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The connection to the database failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Inside of the <code>then()</code> method callback, a message is logged to the console and<br>
the application is started listening for HTTP connections. Inside of the<br>
<code>catch()</code> method callback, an error message and the <code>err</code> object are logged to<br>
the console:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection success! Sequelize is ready to use...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Start listening for connections.</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection failure.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To test the connection to the database, run the command <code>npm start</code> in the<br>
terminal to start your application. In the console, you should see the success<br>
message if the database connection succeeded, otherwise you&apos;ll see the error<br>
message.</p>
<h2 class="mume-header" id="creating-the-book-model">Creating the Book model</h2>

<p>Now that you&apos;ve confirmed that the application can successfully connect to the<br>
database, it&apos;s time to create the application&apos;s first model.</p>
<p>As a reminder, the Reading List website&#x2014;when it&apos;s completed&#x2014;will allow you to<br>
view a list of books, add a book to the list, update a book in the list, and<br>
delete a book from the list. At the heart of all of these features are books, so<br>
let&apos;s use the Sequelize CLI to generate a <code>Book</code> model.</p>
<p>The <code>Book</code> model should include the following properties:</p>
<ul>
<li><code>title</code> - A string representing the title;</li>
<li><code>author</code> - A string representing the the author;</li>
<li><code>releaseDate</code> - A date representing the release date;</li>
<li><code>pageCount</code> - An integer representing the page count; and</li>
<li><code>publisher</code> - A string representing the publisher.</li>
</ul>
<p>From the terminal, run the following command to use the Sequelize CLI to<br>
generate the <code>Book</code> model:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize model:generate --name Book --attributes <span class="token string">&quot;title:string, author:string, releaseDate:dateonly, pageCount:integer, publisher:string&quot;</span>
</pre><p>If the command succeeds, you&apos;ll see the following output in the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">New model was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/models/book.js <span class="token keyword">.</span>
New migration was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/migrations/<span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-Book.js <span class="token keyword">.</span>
</pre><p>This confirms that two files were generated: a file for the <code>Book</code> model and a<br>
file for a database migration to add the <code>Books</code> table to the database.</p>
<h3 class="mume-header" id="updating-the-generated-book-model-and-migration-files">Updating the generated <code>Book</code> model and migration files</h3>

<p>The <code>Book</code> model and migration files generated by the Sequelize CLI are close to<br>
what is needed, but some changes are required. Two things in particular need to<br>
be addressed: column string lengths and column nullability (i.e. the ability for<br>
a column to accept <code>null</code> values).</p>
<p>For your reference, here are the generated model and migration files:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/migrations/[timestamp]-create-book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>As it is, the generated migration file would create the following <code>Books</code> table<br>
in the database:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">reading_list<span class="token operator">=</span><span class="token comment"># \d &quot;Books&quot;</span>
                                        Table <span class="token string">&quot;public.Books&quot;</span>
   Column    <span class="token operator">|</span>           Type           <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>               Default
-------------+--------------------------+-----------+----------+-------------------------------------
 <span class="token function">id</span>          <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">&apos;&quot;Books_id_seq&quot;&apos;</span>::regclass<span class="token punctuation">)</span>
 title       <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 author      <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 releaseDate <span class="token operator">|</span> <span class="token function">date</span>                     <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 pageCount   <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 publisher   <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 createdAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 updatedAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
Indexes:
    <span class="token string">&quot;Books_pkey&quot;</span> PRIMARY KEY, btree <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</pre><p>Notice that all of the <code>Book</code> <code>string</code> based properties (i.e. <code>title</code>, <code>author</code>,<br>
and <code>publisher</code>) resulted in columns with a data type of <code>character varying(255)</code>, which is a variable length text based column up to 255 characters<br>
in length. Allowing for 255 characters for the <code>title</code> column seems about right,<br>
but for the <code>author</code> and <code>publisher</code> columns, it seems excessive.</p>
<p>Also notice that the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and<br>
<code>publisher</code> columns all allow <code>null</code> values (a value of <code>not null</code> in the<br>
&quot;Nullable&quot; column means that the column doesn&apos;t allow <code>null</code> values, otherwise<br>
the column allows <code>null</code> values). Ideally, each book in the database would have<br>
values for all of those columns.</p>
<p>We can address both of these issues by updating the <code>./db/models/book.js</code> file<br>
to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The migration file <code>./db/migrations/[timestamp]-create-book.js</code> also needs to be<br>
updated to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/migrations/[timestamp]-create-book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="applying-the-pending-migration">Applying the pending migration</h3>

<p>After resolving the column data type and nullability issues in the model and<br>
migration files, you&apos;re ready to apply the pending migration to create the<br>
<code>Books</code> table in the database. In the terminal, run the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:migrate
</pre><p>Notice that you&apos;re using npx to invoke the <code>dotenv</code> tool which loads your<br>
environment variables from the <code>.env</code> file and then invokes the <code>sequelize db:migrate</code> command. In the console, you should see something similar to the<br>
following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Loaded configuration <span class="token function">file</span> <span class="token string">&quot;config/database.js&quot;</span><span class="token keyword">.</span>
Using environment <span class="token string">&quot;development&quot;</span><span class="token keyword">.</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-create-book: migrating <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-create-book: migrated <span class="token punctuation">(</span>0.021s<span class="token punctuation">)</span>
</pre><p>To confirm the creation of the <code>Books</code> table, you can run the following command<br>
from within psql:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">\d <span class="token string">&quot;Books&quot;</span>
</pre><blockquote>
<p>Be sure that you&apos;re connected to the <code>reading_list</code> database in psql. If you<br>
are, the cursor should read <code>reading_list=#</code>. If you&apos;re not connected to the<br>
correct database, you can run the command <code>\c reading_list</code> to connect to the<br>
<code>reading_list</code> database.</p>
</blockquote>
<p>After running the <code>\d &quot;Books&quot;</code> command, you should see the following output<br>
within psql:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">                                        Table <span class="token string">&quot;public.Books&quot;</span>
   Column    <span class="token operator">|</span>           Type           <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>               Default
-------------+--------------------------+-----------+----------+-------------------------------------
 <span class="token function">id</span>          <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">&apos;&quot;Books_id_seq&quot;&apos;</span>::regclass<span class="token punctuation">)</span>
 title       <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 author      <span class="token operator">|</span> character varying<span class="token punctuation">(</span>100<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 releaseDate <span class="token operator">|</span> <span class="token function">date</span>                     <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 pageCount   <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 publisher   <span class="token operator">|</span> character varying<span class="token punctuation">(</span>100<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 createdAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 updatedAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
Indexes:
    <span class="token string">&quot;Books_pkey&quot;</span> PRIMARY KEY, btree <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="seeding-the-database">Seeding the database</h2>

<p>With the <code>Books</code> table created in the database, you&apos;re ready to seed the table<br>
with some test data!</p>
<p>To start, you need to create a seed file by running the following command in the<br>
terminal from the root of your project:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize seed:generate --name test-data
</pre><p>If the command succeeds, you&apos;ll see the following output in the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">seeders folder at <span class="token string">&quot;[path to the project folder]/db/seeders&quot;</span> already exists.
New seed was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/seeders/<span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data.js <span class="token keyword">.</span>
</pre><p>This confirms that the seed file was generated. Go ahead and replace the<br>
contents of the <code>./db/seeders/[timestamp]-test-data.js</code> with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/seeders/[timestamp]-test-data.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">bulkInsert</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;The Martian&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;Andy Weir&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-02-11&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">384</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Crown&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Ready Player One&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;Ernest Cline&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2011-08-16&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">384</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Crown&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Harry Potter and the Sorcerer\&apos;s Stone&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;J.K. Rowling&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1998-10-01&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">309</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Scholastic Press&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">bulkDelete</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>up</code> property references an anonymous method that uses the<br>
<code>queryInterface.bulkInsert()</code> method to insert an array of books into the <code>Book</code><br>
table while the <code>down</code> property references an anonymous method that uses the<br>
<code>queryInterface.bulkDelete()</code> method to delete all of the data in the <code>Books</code><br>
table.</p>
<blockquote>
<p>Feel free to add to the array of books&#x2026; have fun with it!</p>
</blockquote>
<p>To seed your database with your test data, run the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:seed:all
</pre><p>In the console, you should see something similar to the following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Loaded configuration <span class="token function">file</span> <span class="token string">&quot;config/database.js&quot;</span><span class="token keyword">.</span>
Using environment <span class="token string">&quot;development&quot;</span><span class="token keyword">.</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data: migrating <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data: migrated <span class="token punctuation">(</span>0.009s<span class="token punctuation">)</span>
</pre><p>Then you can use psql to check if the <code>Books</code> table contains the test data:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token keyword">select</span> * from <span class="token string">&quot;Books&quot;</span><span class="token punctuation">;</span>
</pre><p>Which should produce the following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"> <span class="token function">id</span> <span class="token operator">|</span>                 title                 <span class="token operator">|</span>    author    <span class="token operator">|</span> releaseDate <span class="token operator">|</span> pageCount <span class="token operator">|</span>    publisher     <span class="token operator">|</span>         createdAt          <span class="token operator">|</span>         updatedAt
----+---------------------------------------+--------------+-------------+-----------+------------------+----------------------------+----------------------------
  2 <span class="token operator">|</span> The Martian                           <span class="token operator">|</span> Andy Weir    <span class="token operator">|</span> 2014-02-11  <span class="token operator">|</span>       384 <span class="token operator">|</span> Crown            <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
  3 <span class="token operator">|</span> Ready Player One                      <span class="token operator">|</span> Ernest Cline <span class="token operator">|</span> 2011-08-16  <span class="token operator">|</span>       384 <span class="token operator">|</span> Crown            <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
  4 <span class="token operator">|</span> Harry Potter and the Sorcerer&apos;s Stone <span class="token operator">|</span> J.K. Rowling <span class="token operator">|</span> 1998-10-01  <span class="token operator">|</span>       309 <span class="token operator">|</span> Scholastic Press <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
<span class="token punctuation">(</span>3 rows<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="querying-and-rendering-a-temporary-list-of-books">Querying and rendering a temporary list of books</h2>

<p>Now that you&apos;ve installed and configured Sequelize, created the <code>Book</code> model and<br>
associated migration, and seeded the <code>Books</code> table, you&apos;re ready to update your<br>
application&apos;s default route to query the for a list of books and render the data<br>
in the <code>index</code> view!</p>
<p>In the <code>routes</code> module (the <code>./routes.js</code> file), use the <code>require()</code> function to<br>
import the <code>models</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the default route (<code>/</code>) to this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>async</code> keyword was added to make the route handler an asynchronous function<br>
and the <code>db.Book.findAll()</code> method is used to retrieve a list of books from the<br>
database.</p>
<p>For your reference, here&apos;s what the complete <code>./routes.js</code> file should look<br>
like:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>Now you can update the <code>./views/index.pug</code> view to render the array of books:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
  <span class="token tag">h3</span> <span class="token plain-text">Books</span>
  <span class="token tag">ul</span>
    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
      <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
</pre><p>For now, the formatting of the book list is very simple. In the next article,<br>
you&apos;ll see how to use Bootstrap to improve the look and feel of the book list<br>
table.</p>
<p>Run the command <code>npm start</code> to start your application (if it&apos;s not already<br>
started) and browse to <code>http://localhost:8080/</code>. You should see the list of<br>
books from the database rendered to the page in an unordered list!</p>
<h2 class="mume-header" id="what-you-learned-4">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Install and configure Sequelize within an Express application; and</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Using the Sequelize CLI to create a model;</li>
<li>Using the Sequelize CLI to seed the database; and</li>
<li>Using Sequelize to query data from the database.</li>
</ul>
<p>Next up: creating the routes and views to perform CRUD (create, read, update,<br>
and delete) operations using Sequelize!</p>
<hr>
<h1 class="mume-header" id="data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations">Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</h1>

<p>Welcome to part three of creating the data-driven Reading List website!</p>
<p>Over the course of three articles, you&apos;ll create a data-driven Reading List<br>
website that will allow you to view a list of books, add a book to the list,<br>
update a book in the list, and delete a book from the list. In the first<br>
article, you created the project. In the second article, you learned how to<br>
integrate Sequelize with an Express application. In this article, you&apos;ll create<br>
the routes and views to perform CRUD (create, read, update, and delete)<br>
operations using Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Define a collection of routes and views that use Sequelize to perform CRUD<br>
operations against a single resource; and</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Using a wrapper function to catch errors thrown within asynchronous route<br>
handler functions;</li>
<li>Using Pug to create HTML forms;</li>
<li>Using the <code>csurf</code> middleware to protect against CSRF exploits;</li>
<li>Using the built-in <code>express.urlencoded()</code> middleware function to parse<br>
incoming request body form data;</li>
<li>Using Sequelize model validations to validate user-provided data;</li>
<li>Using the <code>express-validator</code> validation library to validate user-provided<br>
data within an Express route; and</li>
<li>Using Pug includes and mixins to remove unnecessary code duplication.</li>
</ul>
<h2 class="mume-header" id="planning-the-routes-and-views">Planning the routes and views</h2>

<p>Before creating any new routes or views, it&apos;s a good idea to plan out what pages<br>
need to be added to support the required CRUD (create, read, update, and delete)<br>
operations along with their associated routes, HTTP methods, and views.</p>
<p>Here&apos;s a list of the proposed pages to add to the Reading List application:</p>
<table>
<thead>
<tr>
<th>Page Name</th>
<th>Route Path</th>
<th>HTTP Methods</th>
<th>View Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Book List</td>
<td><code>/</code></td>
<td><code>GET</code></td>
<td><code>book-list.pug</code></td>
</tr>
<tr>
<td>Add Book</td>
<td><code>/book/add</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-add.pug</code></td>
</tr>
<tr>
<td>Edit Book</td>
<td><code>/book/edit/:id</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-edit.pug</code></td>
</tr>
<tr>
<td>Delete Book</td>
<td><code>/book/delete/:id</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-delete.pug</code></td>
</tr>
</tbody>
</table>
<p>There are a number of acceptable ways that you could approach implementing the<br>
required CRUD operations for the <code>Book</code> resource or model. The above approach is<br>
a common, tried-and-true way of implementing CRUD operations within a<br>
server-side rendered web application.</p>
<blockquote>
<p>The term <strong>server-side rendered</strong> simply means that all of the work of<br>
generating the HTML for the web application&apos;s pages is done on the server.<br>
Later on, you&apos;ll learn how to use client-side technologies like React to move<br>
some of that work to the client (i.e. the browser).</p>
</blockquote>
<p>Notice that the &quot;Add Book&quot;, &quot;Edit Book&quot;, and &quot;Delete Book&quot; pages need to support<br>
both the <code>GET</code> and <code>POST</code> HTTP methods. The <code>GET</code> HTTP method will be used to<br>
initially retrieve each page&apos;s HTML form while the <code>POST</code> HTTP method will be<br>
used to process each page&apos;s HTML form submissions.</p>
<p>Also notice that the route paths for the &quot;Edit Book&quot; and &quot;Delete Book&quot; pages<br>
define an <code>:id</code> route parameter. Without a book ID, those pages wouldn&apos;t know<br>
what book record they were supposed to be editing or deleting. The &quot;Add Book&quot;<br>
page doesn&apos;t need an <code>:id</code> route parameter because that page is adding a new<br>
book record, so a book ID isn&apos;t needed (the ID for the new record will be<br>
created by the database when the record is inserted into the table).</p>
<p>Now that you have a plan, let&apos;s start building out the proposed pages&#x2014;starting<br>
with the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="creating-the-book-list-page">Creating the Book List page</h2>

<p>As a reminder, here&apos;s what the default route (<code>/</code>) in the <code>routes</code> module (i.e.<br>
the <code>routes.js</code> file) looks like at this point:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>And the <code>./views/index.pug</code> view:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
  <span class="token tag">h3</span> <span class="token plain-text">Books</span>
  <span class="token tag">ul</span>
    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
      <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
</pre><p>It&apos;s a small change, but start with renaming the <code>./views/index.pug</code> view to<br>
<code>./views/book-list.pug</code>. Changing the name of the view will make it easier to<br>
identify the purpose of the view at a glance.</p>
<p>After renaming the view, update the call to the <code>res.render()</code> method in the<br>
default route:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice that the <code>title</code> property&#x2014;on the object passed as the second argument to<br>
the <code>res.render()</code> method&#x2014;was changed from &quot;Home&quot; to &quot;Books&quot;.</p>
<h3 class="mume-header" id="applying-bootstrap-styles-to-the-book-list-page">Applying Bootstrap styles to the Book List page</h3>

<p>When you added Bootstrap to the project in the first article in this series, it<br>
was mentioned that the look of the application wouldn&apos;t change much at that<br>
point. Let&apos;s change that!</p>
<p>Update the <code>./views/book-list.pug</code> view with the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-list.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-3&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-success&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/book/add&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
  <span class="token tag">table<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;table table-striped table-hover&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">thead<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;thead-dark&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">tr</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">tbody</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
        <span class="token tag">tr</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>author</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>releaseDate</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>pageCount</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>publisher</span>
          <span class="token tag">td</span>
            <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-primary&apos;</span> href<span class="token operator">=</span><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Edit</span>
            <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-danger ml-2&apos;</span> href<span class="token operator">=</span><span class="token template-string"><span class="token string">`/book/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Delete</span>
</pre><p>Here&apos;s an overview of the above Pug template code:</p>
<ul>
<li>A hyperlink (<code>&lt;a&gt;</code>) at the top of the page (<code>a(class=&apos;btn btn-success&apos; href=&apos;/book/add&apos; role=&apos;button&apos;) Add Book</code>) gives users a way to navigate to<br>
the &quot;Add Book&quot; page. The hyperlink is styled to look like a button using the<br>
<a href="https://getbootstrap.com/docs/4.4/components/buttons/">Bootstrap button CSS classes</a> (<code>btn btn-success</code>).</li>
<li>An HTML table is used to render the list of books. The <a href="https://getbootstrap.com/docs/4.4/content/tables/">Bootstrap table CSS<br>
classes</a> (<code>table table-striped table-hover</code>) are used to<br>
style the table.</li>
<li>Each row in the books HTML table contains two hyperlinks&#x2014;one to navigate to<br>
the &quot;Edit Book&quot; page and another to navigate to the &quot;Delete Book&quot; page. Again,<br>
both hyperlinks are styled to look like buttons using the <a href="https://getbootstrap.com/docs/4.4/components/buttons/">Bootstrap button<br>
CSS classes</a>.</li>
</ul>
<blockquote>
<p>For more information about the Bootstrap front-end component library, see <a href="https://getbootstrap.com/docs/4.4/">the<br>
official documentation</a>.</p>
</blockquote>
<h3 class="mume-header" id="adding-an-asynchronous-route-handler-wrapper-function">Adding an asynchronous route handler wrapper function</h3>

<p>In an earlier article, you learned that Express is unable to catch errors thrown<br>
by asynchronous route handlers. Given that, asynchronous route handlers need to<br>
catch their own errors and pass them to the <code>next()</code> method. That&apos;s exactly what<br>
the default route handler is currently doing:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>While you could continue to add <code>try</code>/<code>catch</code> statements to each of your route<br>
handlers, defining a simple asynchronous route handler wrapper function will<br>
keep you from having to write that boilerplate code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>For your reference, here&apos;s what the <code>./routes.js</code> file should look like at this<br>
point in the project:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="testing-the-book-list-page">Testing the Book List page</h3>

<p>Open a terminal and browse to your project folder. Run the command <code>npm start</code><br>
to start your application and browse to <code>http://localhost:8080/</code>. You should see<br>
the list of books from the database rendered to the page&#x2014;but instead of using an<br>
unordered list to format the list of books you should see a nicely Bootstrap<br>
formatted HTML table!</p>
<h2 class="mume-header" id="adding-the-add-book-page">Adding the Add Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Add Book&quot;<br>
page. As the name clearly suggests, this page will allow you to add a new book<br>
to the reading list.</p>
<h3 class="mume-header" id="adding-protection-from-csrf-attacks">Adding protection from CSRF attacks</h3>

<p>Before adding the route and view for the &quot;Add Book&quot; page, go ahead and prepare<br>
to add protection from CSRF attacks by installing and configuring the necessary<br>
dependencies and middleware.</p>
<p>To review, Cross-Site Request Forgery (CSRF) is an attack that results in an end<br>
user executing unwanted actions within a web application. Imagine that the<br>
Reading List website requires users to login before they can view and make<br>
changes to their reading list (in a future article you&apos;ll learn how to implement<br>
user login within an Express application!) If a user was currently logged into<br>
the Reading List website, a CSRF attack would trick the user into clicking a<br>
link that unexpectedly sends a POST request to the Reading List website&#x2014;a<br>
request that might add or delete a book without the user&apos;s consent!</p>
<p>While this particular example is trivial in terms of its impact to the user,<br>
imagine that the affected web application is a banking application. The end user<br>
could end up unintentionally transferring money to the hacker&apos;s bank account!</p>
<blockquote>
<p>For a detailed walkthrough of a CSRF attack and how to protect against CSRF<br>
attacks, see the &quot;Protecting Forms from CSRF&quot; article in the Express HTML<br>
Forms lesson.</p>
</blockquote>
<p>From a terminal, install the following dependencies into your project:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> csurf@^1.0.0
<span class="token function">npm</span> <span class="token function">install</span> cookie-parser@^1.0.0
</pre><p>Within the <code>app</code> module (i.e. the <code>./app.js</code> file), use the <code>require()</code> function<br>
to import the <code>cookie-parser</code> middleware and call the <code>app.use()</code> method to add<br>
the middleware just after adding the <code>morgan</code> middleware to the request<br>
pipeline. While you&apos;re updating the <code>app</code> module, go ahead and add the built-in<br>
Express <code>urlencoded</code> middleware after adding the <code>cookie-parser</code> middleware<br>
(you&apos;ll need the <code>urlencoded</code> middleware to parse the request body form data in<br>
just a bit):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;morgan&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;cookie-parser&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&apos;dev&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="defining-the-routes-for-the-add-book-page">Defining the routes for the Add Book page</h3>

<p>Now you&apos;re ready to define the routes for the &quot;Add Book&quot; page!</p>
<p>At the top of the <code>routes</code> module (i.e. the <code>./routes.js</code> file), add a call to<br>
the <code>require()</code> function to import the <code>csurf</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>
</pre><p>Then call the <code>csurf()</code> function to create the <code>csrfProtection</code> middleware that<br>
you&apos;ll add to each of the routes that need CSRF protection:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> csrfProtection <span class="token operator">=</span> <span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cookie<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>
</pre><p>Now you&apos;re ready to add the routes for the &quot;Add Book&quot; page to the <code>routes</code><br>
module just after the existing default route (<code>/</code>)&#x2014;a <code>GET</code> route to initially<br>
retrieve the &quot;Add Book&quot; page&apos;s HTML form and a <code>POST</code> route to process the<br>
page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      error<span class="token punctuation">:</span> err<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Two routes are defined for the &quot;Add Book&quot; page&#x2014;a <code>/book/add</code> <code>GET</code> route and a<br>
<code>/book/add</code> <code>POST</code> route. As mentioned earlier, the <code>GET</code> route is used to<br>
initially retrieve the page&apos;s HTML form while the <code>POST</code> route is used to<br>
process submissions from the page&apos;s HTML form.</li>
<li>Both routes use the <code>csrfProtection</code> middleware to protect against CSRF<br>
attacks.</li>
<li>Within the <code>GET</code> route handler, the Sequelize <code>db.Book.build()</code> method is used<br>
to create a new instance of the <code>Book</code> model which is then passed to the<br>
<code>book-add</code> view.</li>
<li>Within the <code>POST</code> route handler, destructuring is used to declare and<br>
initialize the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and <code>publisher</code><br>
variables from the <code>req.body</code> property. The <code>title</code>, <code>author</code>, <code>releaseDate</code>,<br>
<code>pageCount</code>, and <code>publisher</code> variables are then used to create a new instance<br>
of the <code>Book</code> model with a call to the <code>db.Book.build()</code> method. The<br>
<code>book.save()</code> method is called on the instance to persist the model to the<br>
database and if that operation succeeds the user is redirected to the default<br>
route (<code>/</code>). If an error occurs, the <code>book-add</code> view is rendered and sent to<br>
the client (so the error can be displayed to the end user).</li>
</ul>
<h3 class="mume-header" id="creating-the-view-for-the-add-book-page">Creating the view for the Add Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-add.pug</code> containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> error</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Here&apos;s an overview of the above Pug template code:</p>
<ul>
<li>A conditional statement checks to see if the <code>error</code> variable is truthy (i.e.<br>
has a reference to an error) and if there&apos;s an error, the <code>JSON.stringify()</code><br>
method is used to render the error to the page as JSON. Later in this article,<br>
you&apos;ll refactor this part of the view to improve the display of errors to the<br>
end user.</li>
<li>A hidden <code>&lt;input&gt;</code> element is used to render the CSRF token value to the page<br>
(i.e. <code>input(type=&apos;hidden&apos; name=&apos;_csrf&apos; value=csrfToken)</code>).</li>
<li>A series of <code>&lt;label&gt;</code> and text <code>&lt;input&gt;</code> elements are rendered to create the<br>
form fields for the <code>Book</code> model <code>title</code>, <code>author</code>, <code>releaseDate</code>,<br>
<code>pageCount</code>, and <code>publisher</code> properties. The <a href="https://getbootstrap.com/docs/4.4/components/forms/">Bootstrap form CSS<br>
classes</a> (<code>form-group</code>, <code>form-control</code>) are used to style the<br>
form.</li>
<li>At the bottom of the form, a submit <code>&lt;button&gt;</code> element is rendered along with<br>
a &quot;Cancel&quot; hyperlink that allows the end user to navigate back to the &quot;Book<br>
List&quot; page.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> HTML <code>&lt;input&gt;</code> element types aren&apos;t used to their fullest extent in<br>
the above code. Feel free to experiment with using <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#%3Cinput%3E_types">the available <code>&lt;input&gt;</code><br>
element types</a> to add client-side validation but<br>
remember that client-side validation is intended only to improve the end user<br>
experience. Because client-side validation can easily be thwarted, validating<br>
data on the server is absolutely essential to do. You&apos;ll implement server-side<br>
validation in just a bit.</p>
</blockquote>
<h3 class="mume-header" id="testing-the-add-book-page">Testing the Add Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Provide a value for each of the<br>
form fields and click the &quot;Add Book&quot; button to submit the form to the server. Be<br>
sure that you provide a valid date value (i.e. &quot;2000-01-31&quot;). You should now see<br>
your new book in the list of books on the &quot;Book List&quot; page!</p>
<p>If you click the &quot;Add Book&quot; button again and submit the &quot;Add Book&quot; page form<br>
without providing any values, an error occurs when attempting to persist an<br>
instance of the <code>Book</code> model to the database. The lengthy error message<br>
displayed just above the form will look like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SequelizeDatabaseError&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">116</span><span class="token punctuation">,</span>
    <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ERROR&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22007&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datetime.c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3774&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DateTimeParseError&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">116</span><span class="token punctuation">,</span>
    <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ERROR&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22007&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datetime.c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3774&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DateTimeParseError&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><p>From the error message, you can see that a <code>SequelizeDatabaseError</code> occurred<br>
when attempting to insert into the <code>Books</code> table. The underlying error is a<br>
date/time parse error, which is occurring because you didn&apos;t supply a value for<br>
the <code>releaseDate</code> property on the <code>Book</code> model.</p>
<p>It&apos;s not just empty strings that result in date/time parse errors. Improperly<br>
formatted date/time <code>string</code> values&#x2014;or simply bad <code>string</code> values&#x2014;can also<br>
produce date/time parse errors. For example, all of the following <code>string</code><br>
date/time values cannot be parsed to date/time values:</p>
<ul>
<li>Jan 31st 2002</li>
<li>100/31/2002</li>
<li>Jaanuary 31, 2002</li>
</ul>
<p>You can use the <code>input</code> element&apos;s <code>placeholder</code> attribute to communicate to<br>
users an example of the expected input format. Refactor your <code>input#releaseDate</code><br>
element to include a placeholder:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> </span>
      <span class="token attr-name">id</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span> </span>
      <span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span> </span>
      <span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value">book<span class="token punctuation">.</span>releaseDate </span>
      <span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-control&apos;</span> </span>
      <span class="token attr-name">placeholder</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
</pre><p>Time to implement server-side validations! You&apos;ll see how to implement<br>
validations using two different approaches&#x2014;within the <code>Book</code> database model<br>
using Sequelize&apos;s built-in model validation and within the &quot;Add Book&quot; page<br>
<code>POST</code> route using the <code>express-validator</code> validation library.</p>
<h2 class="mume-header" id="implementing-server-side-validation-using-sequelize">Implementing server-side validation using Sequelize</h2>

<p>Before updating the <code>Book</code> model (the <code>./db/models/book.js</code> file), make a copy<br>
of the existing code by copying the entire file with a file extension of <code>.bak</code><br>
(i.e. <code>book.js.bak</code>) or simply copying and pasting the code within the existing<br>
file and commenting it out. When implementing validation at the route level<br>
using a validation library, you&apos;ll want a convenient way to remove or disable<br>
the validations in the <code>Book</code> model.</p>
<h3 class="mume-header" id="adding-validations-to-the-book-model">Adding validations to the <code>Book</code> model</h3>

<p>Now you&apos;re ready to update the <code>Book</code> model to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isInt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above code:</p>
<ul>
<li>Sequelize validation rules or validators are applied to model<br>
properties&#x2014;referred to by Sequelize as &quot;attributes&quot;&#x2014;using the <code>validate</code><br>
property. The <code>validate</code> property is set to an object whose properties<br>
represent each validation rule to apply to the model attribute.</li>
<li>For the <code>string</code> based model attributes (i.e. text based database table<br>
columns) that don&apos;t allow <code>null</code> values&#x2014;the <code>title</code>, <code>author</code>, <code>publisher</code><br>
properties&#x2014;the <code>notNull</code> and <code>notEmpty</code> validators are applied to disallow<br>
<code>null</code> values <strong>and</strong> empty string values.</li>
<li>Notice the nuance between the <code>allowNull</code> model attribute property and the<br>
<code>notNull</code> validation rule. The <code>allowNull</code> model attribute property is set to<br>
<code>false</code> to configure the underlying database table column to disallow <code>null</code><br>
values and the <code>notNull</code> validation rule is applied to validate that a model<br>
instance attribute value is not <code>null</code>.</li>
<li>The <code>len</code> validation is also applied to the <code>string</code> based model attributes to<br>
give feedback to the end user when a model instance attribute value exceeds<br>
the configured maximum length for the underlying database table column.</li>
<li>The <code>isDate</code> and <code>isInt</code> validators are applied respectively to the<br>
<code>releaseDate</code> and <code>pageCount</code> model attributes to validate that the model<br>
instance attribute values can be successfully parsed to the underlying<br>
database table column data types.</li>
</ul>
<blockquote>
<p>Sequelize provides a variety of validators that you can apply to model<br>
attributes. For a list of the available validators, see <a href="https://sequelize.org/v5/manual/models-definition.html#validations">the official<br>
Sequelize documentation</a>.</p>
</blockquote>
<blockquote>
<p>For more information about Sequelize model validations see the &quot;Model<br>
Validations With Sequelize&quot; article in the SQL ORM lesson.</p>
</blockquote>
<h3 class="mume-header" id="updating-the-add-book-page-post-route">Updating the Add Book page <code>POST</code> route</h3>

<p>With the model validations in place, now you need to update the &quot;Add Book&quot; page<br>
<code>POST</code> route in the <code>routes</code> module (the <code>./routes.js</code> file) to process<br>
Sequelize validation errors.</p>
<p>To start, add the <code>next</code> parameter to the route handler function&apos;s parameter<br>
list:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Code removed for brevity.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the <code>try</code>/<code>catch</code> statement to this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;SequelizeValidationError&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> errors <span class="token operator">=</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      errors<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Within the <code>catch</code> block, the <code>err.name</code> property is checked to see if the error<br>
is a <code>SequelizeValidationError</code> error type which is the error type that<br>
Sequelize throws if a validation error has occurred.</p>
<p>If it&apos;s a validation error, the <code>Array#map()</code> method is called on the<br>
<code>err.errors</code> array to create an array of error messages. Currently, <code>err</code> is an<br>
object with an <code>errors</code> property.</p>
<p>The <code>err.errors</code> property is an array of <em>error objects</em> that provide detailed<br>
information about each validation error. Each element in <code>err.errors</code> has a<br>
<code>message</code> property. The <code>Array#map()</code> method plucks the <code>message</code> property from<br>
each <em>error object</em> to create an array of validation messages. This array of<br>
validation messages will be rendered on the form, instead of the array of<br>
<em>error objects</em>.</p>
<p>If the error isn&apos;t a <code>SequelizeValidationError</code> error, then the error is passed<br>
as an argument to the <code>next()</code> method call which results in Express handing the<br>
request off to the application&apos;s defined error handlers for processing.</p>
<p>For your reference, the updated &quot;Add Book&quot; page <code>POST</code> route should now look<br>
like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;SequelizeValidationError&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-add-book-page-view">Updating the Add Book page view</h3>

<p>The final part of implementing validations is to update the &quot;Add Book&quot; page view<br>
(the <code>./views/book-add.pug</code> file) to render the array of validation messages.<br>
Replace the existing <code>if error</code> conditional statement with the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>

<span class="token comment">//- Code removed for brevity.</span>
</pre><p>The Bootstrap <code>alert alert-danger</code> CSS classes are used to style the unordered<br>
list of validation messages.</p>
<p>For your reference, the updated &quot;Add Book&quot; page view should now look like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><h3 class="mume-header" id="testing-the-server-side-validations">Testing the server-side validations</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Click the &quot;Add Book&quot; button to<br>
submit the &quot;Add Book&quot; page form without providing any values. You should now see<br>
a list of validation messages displayed just above the form.</p>
<p>Provide a value for each of the form fields and click the &quot;Add Book&quot; button to<br>
submit the form to the server. You should now see your new book in the list of<br>
books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="implementing-server-side-validation-using-a-validation-library">Implementing server-side validation using a validation library</h2>

<p>Keeping your application&apos;s validation logic out of your database models makes<br>
your code more modular. Improved modularity allows you to more easily update one<br>
part of your application without worrying as much about how that change will<br>
impact another part of your application.</p>
<p>In this section, you&apos;ll replace the Sequelize model validations with route level<br>
validations using the <code>express-validator</code> validation library.</p>
<h3 class="mume-header" id="removing-the-sequelize-model-validations">Removing the Sequelize model validations</h3>

<p>Before you updated the <code>Book</code> model (the <code>./db/models/book.js</code> file), you made a<br>
copy of the existing code by either copying the entire file with a file<br>
extension of <code>.bak</code> (i.e. <code>book.js.bak</code>) or copying and pasting the code within<br>
the existing file and commenting it out. It&apos;s time to use your backup copy of<br>
the <code>Book</code> model to remove the Sequelize validations.</p>
<p>For your reference, here&apos;s what the <code>Book</code> model (the <code>./db/models/book.js</code><br>
file) should look like before proceeding:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-add-book-page-post-route-1">Updating the Add Book page <code>POST</code> route</h3>

<p>From the terminal, use npm to install the <code>express-validator</code> package:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> express-validator@^6.0.0
</pre><p>In the <code>routes</code> module (i.e. the <code>./routes.js</code> file), use the <code>require()</code><br>
function to import the <code>express-validator</code> module (just after importing the<br>
<code>csurf</code> module) and destructuring to declare and initialize the <code>check</code> and<br>
<code>validationResult</code> variables:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> check<span class="token punctuation">,</span> validationResult <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express-validator&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code remove for brevity.</span>
</pre><p>The <code>check</code> variable references a function (defined by the <code>express-validator</code><br>
validation library) that returns a middleware function for validating a request.<br>
When you call the <code>check()</code> method, you pass in the name of the field&#x2014;in this<br>
case a request body form field name&#x2014;that you want to validate:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The value returned by the <code>check()</code> method is a validation chain object. The<br>
object is referred to as a validation &quot;chain&quot; because you can add one or more<br>
validators by making a series of method calls.</p>
<p>One of the validators that you can add to the validation chain is the <code>exists()</code><br>
validator:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>exists()</code> validator will fail if the request body is missing a form field<br>
with the name (or key) <code>title</code> or because we set the <code>checkFalsy</code> option to<br>
<code>true</code> the validator will fail if the request body contains a form field with<br>
the name <code>title</code> but the value is set to a falsy value (eg <code>&quot;&quot;</code>, <code>0</code>, <code>false</code>,<br>
<code>null</code>).</p>
<p>When a validator fails, it&apos;ll add a validation error to the current request. You<br>
can chain a call to the <code>withMessage()</code> method to customize the validation error<br>
message for the previous validator in the chain:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now if the <code>exists()</code> validator for the field <code>title</code> fails, a validation error<br>
will be added to the request with the message &quot;Please provide a value for<br>
Title&quot;.</p>
<p>The <code>express-validator</code> validation library is built on top of the validator.js<br>
library. This means that all of the <a href="https://github.com/validatorjs/validator.js#validators">available validators within the<br>
validator.js library</a> are available for you to use in<br>
your validation logic.</p>
<p>One of the available validators is the <code>isLength()</code> validator, which can be used<br>
to check the length of a string based field:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how the <code>isLength()</code> method is called directly on the return value of the<br>
<code>withMessage()</code> method? This is the validation chain in action&#x2014;each method call<br>
in the validation chain returns the validation chain so you can keep adding<br>
validators. This is also known as &quot;method chaining&quot;.</p>
<blockquote>
<p>APIs that make use of method chaining are often referred to as <a href="https://en.wikipedia.org/wiki/Fluent_interface">fluent<br>
APIs</a>.</p>
</blockquote>
<p>Instead of declaring a variable for each field that you want to define a<br>
validation chain for, you can declare a single variable that&apos;s initialized to an<br>
array of validation chains:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> bookValidators <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isISO8601</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> min<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</pre><p>Each validation chain is an Express middleware function. After initializing an<br>
array containing all of your field validation chains, you can simply add the<br>
array directly to your route definition:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Code removed for brevity.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because each field validation chain is a middleware function and the Express<br>
Application <code>post()</code> method accepts an array of middleware functions, each<br>
validation chain will be called when the request matches the route path.</p>
<p>Within the route handler function, <code>validationResult()</code> function is used to<br>
extract any validation errors from the current request:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>validatorErrors</code> object provides an <code>isEmpty()</code> method to check if there<br>
are any validation errors. If there aren&apos;t any validation errors, then the<br>
<code>book.save()</code> method is called to persist the book to the database and the user<br>
is redirected to the default route (i.e. the &quot;Book List&quot; page).</p>
<p>If there are validation errors, the <code>array()</code> method is called on the<br>
<code>validatorErrors</code> object to get an array of validation error objects. Each error<br>
object has a <code>msg</code> property containing the validation error message. The<br>
<code>Array#map()</code> method plucks the <code>msg</code> property from each error object into a<br>
new array of validation messages named <code>errors</code>.</p>
<blockquote>
<p>For more information about the <code>express-validator</code> library, see <a href="https://express-validator.github.io/docs/">the official<br>
documentation</a>.</p>
</blockquote>
<p>For your reference, here&apos;s what the <code>./routes.js</code> file should look like after<br>
being updated:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> check<span class="token punctuation">,</span> validationResult <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express-validator&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> csrfProtection <span class="token operator">=</span> <span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cookie<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bookValidators <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isISO8601</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> min<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="testing-the-updated-server-side-validations">Testing the updated server-side validations</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Click the &quot;Add Book&quot; button to<br>
submit the &quot;Add Book&quot; page form without providing any values. You should now see<br>
a list of validation messages displayed just above the form.</p>
<p>Provide a value for each of the form fields and click the &quot;Add Book&quot; button to<br>
submit the form to the server. You should now see your new book in the list of<br>
books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="adding-the-edit-book-page">Adding the Edit Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Edit Book&quot;<br>
page. As the name clearly suggests, this page will allow you to edit the details<br>
of a book from the reading list.</p>
<h3 class="mume-header" id="defining-the-routes-for-the-edit-book-page">Defining the routes for the Edit Book page</h3>

<p>Add the routes for the &quot;Edit Book&quot; page to the <code>routes</code> module (i.e. the<br>
<code>./routes.js file) just after the routes for the &quot;Add Book&quot; page&#x2014;a</code>GET<code>route to initially retrieve the &quot;Edit Book&quot; page&apos;s HTML form and a</code>POST` route to<br>
process the page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/edit/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-edit&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Edit Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/edit/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bookToUpdate <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> bookToUpdate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-edit&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Edit Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>book<span class="token punctuation">,</span> id<span class="token punctuation">:</span> bookId <span class="token punctuation">}</span><span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Just like you did for the &quot;Add Book&quot; page, two routes are defined for the<br>
&quot;Edit Book&quot; page&#x2014;a <code>GET</code> route and a <code>POST</code> route, both with a path of<br>
<code>/book/edit/:id(\\d+)</code>. The <code>:id(\\d+)</code> path segment defines the <code>id</code><br>
property in your <code>req.params</code>, the route parameter to capture the book ID to<br>
edit. The <code>\\d+</code> segment uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">regexp</a> to ensure that only numbers<br>
(or <strong>d</strong>igits) will match this segment.</li>
<li>Within both route handlers, the <code>parseInt()</code> function is used to convert the<br>
<code>req.params.id</code> property from a string into an integer.</li>
<li>Within both route handlers, the Sequelize <code>db.Book.findByPk()</code> method uses the<br>
book ID to retrieve which book to edit from the database.</li>
<li>Just like in the <code>/book/add</code> route, destructuring is used to declare and<br>
initialize the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and <code>publisher</code><br>
variables from the <code>req.body</code> property. Those variables are then used to<br>
create a <code>book</code> object literal whose properties align with the <code>Book</code> model<br>
properties. If there aren&apos;t any validation errors, the object literal is<br>
passed into the <code>book.update()</code> method to update the book in the database and<br>
the user is redirected to the default route <code>/</code>. If there are validation<br>
errors, the <code>book-edit</code> view is re-rendered with the validation errors.</li>
</ul>
<p>When passing the <code>book</code> object into the <code>book-edit</code> view, you can use spread<br>
syntax to copy the <code>book</code> object literal properties into a new object. To the<br>
right of spreading the <code>book</code> object, an <code>id</code> property is declared and assigned<br>
to the <code>bookId</code> variable value:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">book<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>book<span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> bookId
<span class="token punctuation">}</span>
</pre><p>The spread syntax above actually creates this <code>book</code> object:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">book<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">,</span>
  author<span class="token punctuation">,</span>
  releaseDate<span class="token punctuation">,</span>
  pageCount<span class="token punctuation">,</span>
  publisher<span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> bookId
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="creating-the-view-for-the-edit-book-page">Creating the view for the Edit Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-edit.pug</code> containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>This view is almost the same as the view for the &quot;Add Book&quot; page. On the form<br>
element&apos;s <code>action</code> attribute and the submit button content are different.</p>
<blockquote>
<p>In just a bit, you&apos;ll see how you can leverage features built into Pug to<br>
avoid unnecessary code duplication.</p>
</blockquote>
<h3 class="mume-header" id="testing-the-edit-book-page">Testing the Edit Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Edit&quot; button for one of the books listed in<br>
the table on the &quot;Book List&quot; page to edit that book. Change one or more form<br>
field values and click the &quot;Update Book&quot; button to submit the form to the<br>
server. You should now see the update book in the list of books on the &quot;Book<br>
List&quot; page!</p>
<h3 class="mume-header" id="including-view-templates-for-dryer-code">Including view templates for DRYer code</h3>

<p>Currently, the &quot;Add Book&quot; and &quot;Edit Book&quot; views contain very similar code. Pug<br>
allows you to <code>include</code> the contents of a template within another template. You<br>
can use this feature to eliminate the code duplication between the<br>
<code>./views/book-add.pug</code> and <code>./views/book-edit.pug</code> files.</p>
<p>Start by adding a new file named <code>book-form-fields.pug</code> to the <code>views</code> folder<br>
containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-form-fields.pug</span>

<span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
</pre><p>Then update the <code>book-add.pug</code> and <code>book-edit.pug</code> views to the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">// ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Notice the use of the <code>include</code> keyword to include the contents of the<br>
<code>book-form-fields.pug</code> template.</p>
<p>Another Pug feature&#x2014;mixins&#x2014;allows you to create reusable blocks of Pug code. You<br>
can use this Pug feature to further eliminate code duplication.</p>
<p>Add a new file named <code>utils.pug</code> to the <code>views</code> folder containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/utils.pug</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
</pre><p>Notice that the <code>validationErrorSummary</code> mixin defines an <code>errors</code> parameter. As<br>
you might expect, mixin parameters allow you to pass data into the mixin.</p>
<p>Next, update the <code>book-add.pug</code> and <code>book-edit.pug</code> views to the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">// ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token keyword">block content</span>
  <span class="token mixin"><span class="token name function">+validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token keyword">block content</span>
  <span class="token mixin"><span class="token name function">+validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Notice the use of the <code>include</code> keyword again to include the contents of the<br>
<code>utils.pug</code> template which makes the <code>validationErrorSummary</code> mixin available<br>
within the <code>book-add.pug</code> and <code>book-edit.pug</code> templates. The mixin is called<br>
by prefixing the mixin name with a plus sign (<code>+</code>) and adding a set of<br>
parentheses after the mixin name. Inside of the parentheses, the <code>errors</code><br>
variable is passed as an argument to the <code>validationErrorSummary</code> mixin.</p>
<p>You can go a bit further to eliminate more code duplication. Update the<br>
<code>./views/utils.pug</code> template to contain the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/utils.pug</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">textField</span><span class="token punctuation">(</span>labelText<span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> fieldValue<span class="token punctuation">,</span> placeholder<span class="token punctuation">)</span></span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value">fieldName</span><span class="token punctuation">)</span></span></span><span class="token punctuation">=</span><span class="token code"> labelText</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span>fieldName name<span class="token operator">=</span>fieldName value<span class="token operator">=</span>fieldValue <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span>placeholder</span><span class="token punctuation">)</span></span></span>
</pre><p>Then update the <code>./views/book-form-fields.pug</code> template to contain this code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-form-fields.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Author&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;author&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>author<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Release Date&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>releaseDate<span class="token punctuation">,</span> <span class="token string">&apos;ex: 2000-01-31&apos;</span><span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Page Count&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>pageCount<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;publisher&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>publisher<span class="token punctuation">)</span></span>
</pre><p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Use the &quot;Add Book&quot; page to add a new book and then use<br>
the &quot;Edit Book&quot; page to edit the book. Everything should work as it did before<br>
the refactoring of the view code.</p>
<p>Congratulations on making your code DRYer!</p>
<h2 class="mume-header" id="add-the-delete-book-page">Add the Delete Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Delete<br>
Book&quot; page. This page is relatively simple as it only needs to prompt the user<br>
if the selected book is the book that they want to delete.</p>
<h3 class="mume-header" id="defining-the-routes-for-the-delete-book-page">Defining the routes for the Delete Book page</h3>

<p>Add the routes for the &quot;Delete Book&quot; page to the <code>routes</code> module (i.e. the<br>
<code>./routes.js file) just after the routes for the &quot;Edit Book&quot; page&#x2014;a</code>GET<code>route to initially retrieve the &quot;Delete Book&quot; page&apos;s HTML form and a</code>POST` route to<br>
process the page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/delete/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-delete&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Delete Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/delete/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Just like you did for the &quot;Add Book&quot; and &quot;Edit Book&quot; pages, two routes are<br>
defined for the &quot;Delete Book&quot; page&#x2014;a <code>/book/delete/:id(\\d+)</code> <code>GET</code> route and<br>
a <code>/book/delete/:id(\\d+)</code> <code>POST</code> route.</li>
<li>Within both route handlers, the <code>parseInt()</code> function is used to convert the<br>
<code>req.params.id</code> property string value into a <code>number</code>.</li>
<li>Within both route handlers, the Sequelize <code>db.Book.findByPk()</code> method is used<br>
to retrieve the book to delete from the database.</li>
<li>Within the <code>POST</code> route handler, the <code>book.destroy()</code> method is called to<br>
delete the book from the database and the user is redirected to the default<br>
route (<code>/</code>).</li>
</ul>
<h3 class="mume-header" id="creating-the-view-for-the-delete-book-page">Creating the view for the Delete Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-delete.pug</code> containing the<br>
following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-delete.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">h3</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">p</span> <span class="token plain-text">Proceed with deleting this book?</span>
  <span class="token tag">div</span>
    <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-danger&apos;</span> type<span class="token operator">=</span><span class="token string">&apos;submit&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Delete Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-warning ml-2&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>The purpose of this view is simple: display the title of the book that&apos;s about<br>
to be deleted and render a simple form containing a hidden <code>&lt;input&gt;</code> element for<br>
the CSRF token and a <code>&lt;button&gt;</code> element to submit the form.</p>
<h3 class="mume-header" id="testing-the-delete-book-page">Testing the Delete Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Delete&quot; button for one of the books listed<br>
in the table on the &quot;Book List&quot; page to delete that book. On the &quot;Delete Book&quot;<br>
page, click the &quot;Delete Book&quot; button to delete the book. You should now see that<br>
the book has been removed from the list of books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="what-you-learned-5">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Define a collection of routes and views that use Sequelize to perform CRUD<br>
operations against a single resource; and</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Using a wrapper function to catch errors thrown within asynchronous route<br>
handler functions;</li>
<li>Using Pug to create HTML forms;</li>
<li>Using the <code>csurf</code> middleware to protect against CSRF exploits;</li>
<li>Using the built-in <code>express.urlencoded()</code> middleware function to parse<br>
incoming request body form data;</li>
<li>Using Sequelize model validations to validate user-provided data;</li>
<li>Using the <code>express-validator</code> validation library to validate user-provided<br>
data within an Express route; and</li>
<li>Using Pug includes and mixins to remove unnecessary code duplication.</li>
</ul>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#data-driven-web-sites-learning-objectives">Data-Driven Web Sites Learning Objectives</a></li>
<li><a href="#acclimating-to-environment-variables">Acclimating to Environment Variables</a>
<ul>
<li><a href="#what-are-environment-variables">What are environment variables?</a>
<ul>
<li><a href="#how-are-environment-variables-commonly-used">How are environment variables commonly used?</a></li>
</ul>
</li>
<li><a href="#setting-and-getting-environment-variable-values">Setting and getting environment variable values</a>
<ul>
<li><a href="#setting-an-environment-variable-value">Setting an environment variable value</a></li>
<li><a href="#getting-an-environment-variable-value">Getting an environment variable value</a></li>
</ul>
</li>
<li><a href="#storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</a>
<ul>
<li><a href="#loading-environment-variables-on-application-startup">Loading environment variables on application startup</a></li>
<li><a href="#another-way-to-use-dotenv">Another way to use dotenv</a></li>
<li><a href="#keeping-the-env-file-out-of-source-control">Keeping the <code>.env</code> file out of source control</a></li>
</ul>
</li>
<li><a href="#using-a-module-to-organize-environment-variables">Using a module to organize environment variables</a>
<ul>
<li><a href="#running-npm-binaries">Running npm binaries</a></li>
<li><a href="#defining-environment-specific-npm-scripts">Defining environment specific npm scripts</a></li>
</ul>
</li>
<li><a href="#what-you-learned">What you learned</a></li>
</ul>
</li>
<li><a href="#asynchronous-route-handlers-in-express">Asynchronous Route Handlers in Express</a>
<ul>
<li><a href="#calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</a>
<ul>
<li><a href="#creating-a-simple-asynchronous-function">Creating a simple asynchronous function</a></li>
<li><a href="#setting-up-the-express-application">Setting up the Express application</a></li>
<li><a href="#using-asyncawait">Using <code>async</code>/<code>await</code></a></li>
<li><a href="#catching-errors-thrown-by-asynchronous-functions-or-methods">Catching errors thrown by asynchronous functions or methods</a></li>
</ul>
</li>
<li><a href="#reducing-boilerplate-code">Reducing boilerplate code</a>
<ul>
<li><a href="#writing-an-asynchronous-route-handler-wrapper-function">Writing an asynchronous route handler wrapper function</a></li>
<li><a href="#using-the-asynchronous-route-handler-wrapper-function">Using the asynchronous route handler wrapper function</a></li>
</ul>
</li>
<li><a href="#what-you-learned-1">What you learned</a></li>
<li><a href="#see-also">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#handling-errors-in-express">Handling Errors in Express</a>
<ul>
<li><a href="#setting-up-an-example-express-application">Setting up an example Express application</a></li>
<li><a href="#the-default-error-handler-in-express">The default error handler in Express</a>
<ul>
<li><a href="#do-you-need-a-custom-error-handler">Do you need a custom error handler?</a></li>
</ul>
</li>
<li><a href="#defining-a-custom-error-handler">Defining a custom error handler</a>
<ul>
<li><a href="#defining-multiple-custom-error-handlers">Defining multiple custom error handlers</a></li>
</ul>
</li>
<li><a href="#handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</a>
<ul>
<li><a href="#creating-a-page-not-found-page">Creating a &quot;Page Not Found&quot; page</a></li>
</ul>
</li>
<li><a href="#what-you-learned-2">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-part-1-setting-up-the-project">Data-Driven Websites - Part 1: Setting Up the Project</a>
<ul>
<li><a href="#setting-up-the-project">Setting up the project</a>
<ul>
<li><a href="#initializing-npm-and-installing-dependencies">Initializing npm and installing dependencies</a></li>
</ul>
</li>
<li><a href="#stubbing-out-the-application">Stubbing out the application</a>
<ul>
<li><a href="#testing-the-initial-application-setup">Testing the initial application setup</a></li>
</ul>
</li>
<li><a href="#splitting-the-application-and-server-into-separate-modules">Splitting the application and server into separate modules</a>
<ul>
<li><a href="#updating-the-app-module">Updating the <code>app</code> module</a></li>
<li><a href="#defining-a-new-entry-point-for-the-application">Defining a new entry point for the application</a></li>
<li><a href="#taking-a-closer-look-at-the-binwww-file">Taking a closer look at the <code>./bin/www</code> file</a></li>
</ul>
</li>
<li><a href="#logging-requests-using-morgan">Logging requests using Morgan</a></li>
<li><a href="#adding-custom-error-handlers">Adding custom error handlers</a>
<ul>
<li><a href="#testing-your-custom-error-handlers">Testing your custom error handlers</a></li>
</ul>
</li>
<li><a href="#configuring-environment-variables">Configuring environment variables</a>
<ul>
<li><a href="#adding-the-env-and-envexample-files">Adding the <code>.env</code> and <code>.env.example</code> files</a></li>
<li><a href="#adding-the-config-module">Adding the <code>config</code> module</a></li>
<li><a href="#updating-the-npm-start-script">Updating the npm <code>start</code> script</a></li>
<li><a href="#supporting-debugging-in-visual-studio-code">Supporting debugging in Visual Studio Code</a></li>
</ul>
</li>
<li><a href="#setting-up-bootstrap">Setting up Bootstrap</a></li>
<li><a href="#what-you-learned-3">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-2-integrating-sequelize-with-express">Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</a>
<ul>
<li><a href="#installing-and-configuring-sequelize">Installing and configuring Sequelize</a>
<ul>
<li><a href="#configuring-the-sequelize-cli">Configuring the Sequelize CLI</a></li>
<li><a href="#initializing-sequelize">Initializing Sequelize</a></li>
<li><a href="#creating-a-new-database-and-database-user">Creating a new database and database user</a></li>
<li><a href="#adding-the-database-environment-variables">Adding the database environment variables</a></li>
<li><a href="#configuring-the-sequelize-database-connection">Configuring the Sequelize database connection</a></li>
</ul>
</li>
<li><a href="#testing-the-connection-to-the-database">Testing the connection to the database</a></li>
<li><a href="#creating-the-book-model">Creating the Book model</a>
<ul>
<li><a href="#updating-the-generated-book-model-and-migration-files">Updating the generated <code>Book</code> model and migration files</a></li>
<li><a href="#applying-the-pending-migration">Applying the pending migration</a></li>
</ul>
</li>
<li><a href="#seeding-the-database">Seeding the database</a></li>
<li><a href="#querying-and-rendering-a-temporary-list-of-books">Querying and rendering a temporary list of books</a></li>
<li><a href="#what-you-learned-4">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations">Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</a>
<ul>
<li><a href="#planning-the-routes-and-views">Planning the routes and views</a></li>
<li><a href="#creating-the-book-list-page">Creating the Book List page</a>
<ul>
<li><a href="#applying-bootstrap-styles-to-the-book-list-page">Applying Bootstrap styles to the Book List page</a></li>
<li><a href="#adding-an-asynchronous-route-handler-wrapper-function">Adding an asynchronous route handler wrapper function</a></li>
<li><a href="#testing-the-book-list-page">Testing the Book List page</a></li>
</ul>
</li>
<li><a href="#adding-the-add-book-page">Adding the Add Book page</a>
<ul>
<li><a href="#adding-protection-from-csrf-attacks">Adding protection from CSRF attacks</a></li>
<li><a href="#defining-the-routes-for-the-add-book-page">Defining the routes for the Add Book page</a></li>
<li><a href="#creating-the-view-for-the-add-book-page">Creating the view for the Add Book page</a></li>
<li><a href="#testing-the-add-book-page">Testing the Add Book page</a></li>
</ul>
</li>
<li><a href="#implementing-server-side-validation-using-sequelize">Implementing server-side validation using Sequelize</a>
<ul>
<li><a href="#adding-validations-to-the-book-model">Adding validations to the <code>Book</code> model</a></li>
<li><a href="#updating-the-add-book-page-post-route">Updating the Add Book page <code>POST</code> route</a></li>
<li><a href="#updating-the-add-book-page-view">Updating the Add Book page view</a></li>
<li><a href="#testing-the-server-side-validations">Testing the server-side validations</a></li>
</ul>
</li>
<li><a href="#implementing-server-side-validation-using-a-validation-library">Implementing server-side validation using a validation library</a>
<ul>
<li><a href="#removing-the-sequelize-model-validations">Removing the Sequelize model validations</a></li>
<li><a href="#updating-the-add-book-page-post-route-1">Updating the Add Book page <code>POST</code> route</a></li>
<li><a href="#testing-the-updated-server-side-validations">Testing the updated server-side validations</a></li>
</ul>
</li>
<li><a href="#adding-the-edit-book-page">Adding the Edit Book page</a>
<ul>
<li><a href="#defining-the-routes-for-the-edit-book-page">Defining the routes for the Edit Book page</a></li>
<li><a href="#creating-the-view-for-the-edit-book-page">Creating the view for the Edit Book page</a></li>
<li><a href="#testing-the-edit-book-page">Testing the Edit Book page</a></li>
<li><a href="#including-view-templates-for-dryer-code">Including view templates for DRYer code</a></li>
</ul>
</li>
<li><a href="#add-the-delete-book-page">Add the Delete Book page</a>
<ul>
<li><a href="#defining-the-routes-for-the-delete-book-page">Defining the routes for the Delete Book page</a></li>
<li><a href="#creating-the-view-for-the-delete-book-page">Creating the view for the Delete Book page</a></li>
<li><a href="#testing-the-delete-book-page">Testing the Delete Book page</a></li>
</ul>
</li>
<li><a href="#what-you-learned-5">What you learned</a></li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>